---
title: HTTPS通信机制
date: 2016-04-28 11:32:07
tags: [HTTP]
categories: HTTP
---
为了更好的理解HTTPS，总结一下HTTPS的通信步骤。


![](/images/HTTPS通信机制.jpg)
1、客户端通过发送Client Hello报文开始SSL通信，报文中包含客户端支持的SSL的指定版本，加密组件（Cipher Suite）列表

2、服务端进行SSL通信时，会以Server Hello报文作为应答，和客户端一样，在报文中包含SSL版本，加密组件。服务器的加密组件内容是从接收到的客户端机密组件内筛选出来的。

3、服务器发送Certificate报文，报文中包含公开密钥证书。

4、服务器发送ServerHelloDone报文通知客户端，最初阶段的SSL握手协商部分结束了

5、SSL第一次握手结束之后，客户端以Client Key Exchange报文作为回应，报文中包含通信加密中使用的一种被称为Pre-master secret的随机密码串。该报文已用步骤3中的公钥进行加密

6、客户端继续发送Change Ciper Spec报文，该报文会提示服务器，在此报文之后的通信会采用Pre-master-secret密钥加密

7、客户端发送Finished报文，该报文包含连接至今全部报文的整体校验值，这次握手协议能否成功，要以服务器是否能够正确解密该报文作为判定标准。

8、服务器同样发送Change Cipher Spec报文。

9、服务器同样发送Finished报文

10、服务器和客户端的Finished报文交换完毕之后，SSL连接就算建立完成，当然，通信会受到SSL的保护，从此处开始进行应用层协议的通信，即发送HTTP请求。

11、应用层协议通信，即发送HTTP响应

12、最后由客户端断开连接，断开连接时，发送close_notify报文。

### 使用服务端的公开密码证书建立HTTPS通信的整个过程

1、服务端将公开密钥证书下发给客户端 （公开密钥证书包含服务器的公钥和认证机构的证书）

2、客户端取出证书确认其有效性，取出公开密钥，用公开密钥对随机密码串pre-master-secret进行加密,并发送给服务端

3、服务端用私钥解密客户端发送过来的加密信息，得到随机密码串pre-master-secret。

4、这样在客户端和服务端都拥有了共享密钥pre-master-secret，之后的通信就可以用这个共享密钥进行加密通信。

### HTTPS的缺点
使用HTTPS存在一些问题，它的处理速度会变慢，SSL的慢分两种，一种是服务器和客户端都需要做加密和解密操作大量消耗CPU及内存等资源，另一种是通信慢，因为SSL通信部分消耗网络资源。