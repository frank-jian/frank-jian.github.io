---
title: HTTP基础
date: 2016-04-27 20:58:45
tags: [HTTP]
categories: HTTP
---
1、HTTP协议规定，先从客户端开始建立通信，服务端在没有收到请求之前不会发送响应。

2、请求报文由请求方法，请求URI、协议版本、可选的请求首部字段和内容实体构成的
```
POST(请求方法)    /form/query(请求URI)   HTTP/1.1(协议版本)

(请求首部字段)
Host:jianwl.com
Connection: keep-alive
Content-Type: appliation/x-www-form-urlencoded
Content-Length: 16

(内容实体)
name=zhangsan&age=21
```
3、HTTP协议的特点
- 支持客户端/服务端模式
- 简单快速，客户端向服务器请求服务时，只需传送请求方法和路径。
- 灵活，HTTP允许传输任意的数据对象，传输类型由Content-Type来标记
- HTTP 0.9和1.0使用非持续连接，限制每次连接只处理一个请求，服务器处理完客户端的请求，并收到客户的应答后，即断开连接，采用这种方式节省传输的时间.HTTP1.1使用持续连接，创建TCP连接后，只要任意一方没有明确提出断开连接，则保持TCP连接状态。
- 无状态：HTTP协议是无状态协议，无状态是指对事物处理没有记忆能力，缺乏状态以为着如果后续处理需要前面的信息，必须重传，这样会导致每次连接传送数据量大，引入Cookie，可以将对象的状态记录下来。

HTTP协议的缺点：
1、通信使用明文（不加密），内容可能会被窃听；
2、不验证通信方的身份，因此有可能遭遇伪装；
3、无法证明报文的完整性，所以有可能已遭篡改；

4、TCP断开连接要四次握手，服务端发送带有FIN的首部字段数据包，客户端收到数据包后先发送带有ACK字段的数据包，然后在发送带有FIN字段的数据包，服务端收到后，返回ACK的数据包，断开连接；

5、持久化连接：
持久化连接的特点：只要任意一方没有明确提出断开连接，则保持TCP连接状态。

持久化连接的好处，减少了TCP连接重复建立和断开所造成的额外开销，减轻服务器端的负载。

6、管线化
持久连接使得多数请求以管线化方式发送成为可能，从前发送请求后需等待并收到响应才能发送下一个请求，管线化技术出现后，不用等待响应也可直接发送下一个请求。

7、Http使用cookie来管理状态
Cookie会根据服务端发送的响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie，当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中的加入Cookie值后发送出去。服务器发现客户端发送过来的Cookie后，会去检查究竟是从哪一个客户端发过来的连接请求，然后对比服务器的记录，最后得到之前的状态。
![](/images/Cookie交互场景.jpg)

8、编码提升传输效率
内容编码指明应用在实体内容上的编码格式，并保持实体信息原样压缩，内容编码后的实体由客户端接收并负责解码；
常见的内容编码有：
gzip
compress（unix系统标准压缩）
deflate（zlib）
identify(不进行编码)

9、分块传输
分块传输编码会将实体主体分成多个部分块，每一块都会用十六进制来标记块的大小，而实体主体的最后一块会用“0（CR+LF）来标记”

10、报文主体和实体主体的差异？
报文(message)：
HTTP通信中的基本单位，由8位组字节流组成，通过HTTP通信传输。

实体(Entity):
作为请求或响应的有效载荷数据被传输，其内容由实体首部和实体主体组成。

HTTP报文的主体用于传输请求或响应的实体主体，通常报文主体等于实体主体，只有当传输中进行编码操作是，实体主体内容才会变化。


11、HTTP返回状态码
```
状态码    描述

 2xx	请求正常处理完毕
 200	请求被正常处理了
 204	请求被服务端正常处理，但返回的响应报文中不含实体的主体部分。
 206	客户端进行范围请求，客户端成功执行了这部分的GET请求。

 3xx	重定向状态码
 301    永久重定向，请求资源已被分配了新的URI，以后应使用现在的URI
 302	临时性重定向，请求资源已被分配新的URI，希望用户本次能够使用新的URI访问
 303	303和302状态码有相同的功能，但要求客户端以GET方法获取资源
 304	客户端发送附带条件的请求时，服务器端允许访问，但因请求未满足条件，直接返回304.（如：服务端资源未变可使用客户端未过期的缓存）
 307	和302有着相同的含义
 
 4xx	客户端错误
 400	请求报文中存在语法错误
 401	发送请求需要通过HTTP认证（BASIC认证 DIGST认证）的认证信息
 403	对请求资源的访问被服务器拒绝了
 404	服务器上没有找到请求资源
 
 5xx	服务器错误
 500	服务端执行请求时，发生错误。
 503 	服务器暂时处于超负荷或者正在进行停机维护
```

12、通信数据转发程序：代理、网关、隧道概念
##### 代理
一种具有转发功能的应用程序，它扮演了位于服务器和客户端“中间人”的角色，接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发客户端。
##### 网关
转发其他服务器通信数据的服务器，接收从客户端发送来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理。
##### 隧道
在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序，使用隧道的目的是确保客户端能与服务器进行安全的通信。

13、使用代理服务器的好处？
利用缓存技术减少网络带宽的流量，使用代理的两个基准，一种是是否使用缓存，另一种是是否会修改报文。

14、缓存代理
代理转发响应时，缓存代理会预先将资源的副本保存在代理服务器上，当代理再次接收到相同的资源的请求时，就可以不用从源服务器哪里获取资源了，将之前的缓存资源直接作为响应返回。

15、4种HTTP首部字段类型
HTTP首部字段根据实际用途被分为以下4种：
通用首部字段(General Heaher Fields) -- 请求报文和响应报文都会用到的首部
请求首部字段(Request Header Fields) -- 客户端向服务端发送请求报文时使用的首部
响应首部字段（Response Header Fields） -- 服务端向客户端响应报文时使用的字段
实体首部字段(Entity Header Fields) -- 请求报文和响应报文都会用到的首部

16、缓存的工作机制
Cache-Control: private, max-age=60, no-cache

###### 常用的缓存指令
private: 缓存服务器只给特定的用户提供资源缓存的服务；
public: 缓存服务给所有的用户提供资源缓存服务；
max-age=60,当服务器返回响应中包含max-age指令，缓存过期没有超过60秒，缓存服务器将不对资源的有效性进行确认，直接将缓存响应给客户端。
no-cache,表示缓存服务器会向源服务器进行有效期确认后处理资源;
no-store,不缓存资源
min-fresh:缓存服务器返回至少还未过指定时间的缓存资源。

应用HTTP/1.1版本的缓存服务器遇到同时存在Expires首部字段的情况时，会有限处理max-age指令，而忽略掉Expires首部字段。

17、实体标记Etag是与特定资源关联的确定值，资源更新后ETag也会随之而更新。

18、  加密的两种方式：
###### 通信的加密
HTTP协议中没有加密的机制，但可以通过和SSL（Secure Socket Layer,安全套接层）和TLS（Transport Layer Security,安全传输层协议）的组合使用。用SSL建立安全通信线路之后，就可以在这条线路上进行HTTP通信了，与SSL组合使用的HTTP被称为HTTPS。
###### 内容加密
由于HTTP协议中没有加密机制，那么就对HTTP协议传输的内容本身加密，在这种情况下，客户端要对HTTP报文进行加密处理后再发送请求。仅仅被报文的主体进行加密，对报文的首部不加密，但这样做也会出现一个问题，虽然内容加密了，但仍有被篡改的风险。

19、HTTP的隐患？
1、无法确定请求发送至目标的Web服务器是否按真实意图返回响应的那台服务器，有可能是已伪装的Web服务器。
2、无法确定响应返回到的客户端是否是按真实意图接受响应的那个客户端，有可能是已伪装的客户端。
3、无法确定正在通信的对方是否具备访问权限，因为某些Web服务器上保存着重要的信息，只想发给特定用户通信的权限。
4、无法判定请求是来自何方，出自谁手。
5、即使是无意义的请求也会照单全收，无法阻止海量请求下的DOS攻击（Denial of Service,拒绝服务攻击）行为

20、常见的几种加密技术
###### 共享秘钥加密
加密和解密用同一个密钥的方式，也称为对称加密；

缺点是发送密钥，有可能被窃听，对方得到密钥，就能够机密，不安全。

###### 公开密钥加密
使用一把非对称的密钥，一把叫做私有密钥，另一把叫做公开密钥。发送密文的一方，使用对方的公开密钥进行加密，对方收到被加密的信息后，用私有密钥进行解密。

缺点是，无法证明公开密钥本身就是货真价实的公开密钥，比如，正准备和某台服务器建立公开密钥加密方式下的通信时，如何证明收到的公开密钥就是原本预想的那台服务器发行的公开密钥。或者在公开密钥传输途中，真正的公开密钥已经被攻击者替换掉了。

###### 混合加密机制
1、使用公开密钥加密方式安全地交换稍后共享密钥中要使用的密钥；
2、确保交换的密钥是安全的前提下，使用共享密钥加密的方式进行加密；

这样做的理由？
公开密钥机密比共享密钥复杂，处理速度慢，所以利用各自的优势，增加效率。

###### 证明公开密钥正确性的证书
![](/images/确认公钥的真实性.jpg)

