<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta name="baidu-site-verification" content="Y1BuCj8QZI" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="每天进步一点">
<meta property="og:type" content="website">
<meta property="og:title" content="记录点滴成长">
<meta property="og:url" content="http://jianwl.com/page/3/index.html">
<meta property="og:site_name" content="记录点滴成长">
<meta property="og:description" content="每天进步一点">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="记录点滴成长">
<meta name="twitter:description" content="每天进步一点">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://jianwl.com/page/3/"/>

  <title> 记录点滴成长 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">记录点滴成长</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-books">
          <a href="/books" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            书单
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/多线程设计模式之保护性暂挂-Guarged-Suspension/" itemprop="url">
                  多线程设计模式之保护性暂挂(Guarged Suspension)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-25T22:15:02+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/25/多线程设计模式之保护性暂挂-Guarged-Suspension/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/25/多线程设计模式之保护性暂挂-Guarged-Suspension/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>多线程编程中，为了提高并发性，往往会将一个任务分解为不同的部分，将其交由不同的线程来执行。这些线程间互相协作时，仍然可能出现一个线程去等待另一个线程完成一定的操作，其自身才能继续运行的情形。好比，汽车行驶过程中油量不足时，司机只好到加油站等工作人员将油加满才能继续行驶。</p>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p><strong>场景</strong></p>
<p>多线程获取共享资源需要条件时，这时候就需要用到保护性暂挂模式了。常见的例子是客户端与服务端的通信，客户端会不断的发送请求给服务端，服务端会不停的接受请求，假设我们用队列去存储请求，那么服务端就不能再队列为空的时候去接受请求，<code>这个是存取的条件 -- 队列不能为空</code></p>
<p><strong>数据模型：<code>Request.Java</code></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class Request &#123;</div><div class="line">    private final String name;</div><div class="line"></div><div class="line">    public Request(String name) &#123;</div><div class="line">        this.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String getName() &#123;</div><div class="line">        return name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public String toString() &#123;</div><div class="line">        return &quot;[ Request &quot; + name + &quot; ]&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>用<code>LinkedList</code>来存放<code>Request</code>：<code>RequestQueue.java</code></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">public class RequestQueue &#123;</div><div class="line">    private final LinkedList queue = new LinkedList();</div><div class="line"></div><div class="line">    public synchronized Request getRequest() &#123;</div><div class="line">        while (queue.size() &lt;= 0) &#123;</div><div class="line">            try &#123;</div><div class="line">                System.out.println(Thread.currentThread().getName() + &quot;: wait() begins, queue = &quot; + queue);</div><div class="line">                wait();</div><div class="line">                System.out.println(Thread.currentThread().getName() + &quot;: wait() ends, queue = &quot; + queue);</div><div class="line">            &#125; catch (InterruptedException e) &#123;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        return (Request) queue.removeFirst();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public synchronized void putRequest(Request request) &#123;</div><div class="line">        queue.addLast(request);</div><div class="line">        System.out.println(Thread.currentThread().getName() + &quot;: notifyAll() begins, queue = &quot; + queue);</div><div class="line">        notifyAll();</div><div class="line">        System.out.println(Thread.currentThread().getName() + &quot;: notifyAll() ends, queue = &quot; + queue);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>客户端不断发出请求：<code>ClientThread.java</code></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">public class ClientThread extends Thread &#123;</div><div class="line">    private Random random;</div><div class="line">    private RequestQueue requestQueue;</div><div class="line"></div><div class="line">    public ClientThread(RequestQueue requestQueue, String name, long seed) &#123;</div><div class="line">        super(name);</div><div class="line">        this.requestQueue = requestQueue;</div><div class="line">        this.random = new Random(seed);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void run() &#123;</div><div class="line">        try &#123;</div><div class="line">            for (int i = 0; i &lt; 10000; i++) &#123;</div><div class="line">                Request request = new Request(&quot;No.&quot; + i);</div><div class="line">                System.out.println(Thread.currentThread().getName() + &quot; requests &quot; + request);</div><div class="line">                requestQueue.putRequest(request);</div><div class="line">                Thread.sleep(random.nextInt(1000));</div><div class="line">            &#125;</div><div class="line">        &#125; catch (InterruptedException e) &#123;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>服务端检验队列是否为空，不为空才取，否则线程阻塞:<code>ServerThread.java</code></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class ServerThread extends Thread &#123;</div><div class="line">    private Random random;</div><div class="line">    private RequestQueue requestQueue;</div><div class="line"></div><div class="line">    public ServerThread(RequestQueue requestQueue, String name, long seed) &#123;</div><div class="line">        super(name);</div><div class="line">        this.requestQueue = requestQueue;</div><div class="line">        this.random = new Random(seed);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void run() &#123;</div><div class="line">        try &#123;</div><div class="line">            for (int i = 0; i &lt; 10000; i++) &#123;</div><div class="line">                Request request = requestQueue.getRequest();</div><div class="line">                System.out.println(Thread.currentThread().getName() + &quot; handles &quot; + request);</div><div class="line">                Thread.sleep(random.nextInt(1000));</div><div class="line">            &#125;</div><div class="line">        &#125; catch (InterruptedException e) &#123;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>主函数：Main.java</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public class Main &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        // 启动执行器</div><div class="line">        RequestQueue requestQueue = new RequestQueue();</div><div class="line">        Thread alice = new ClientThread(requestQueue, &quot;Alice&quot;, 314159L);</div><div class="line">        Thread bobby = new ServerThread(requestQueue, &quot;Bobby&quot;, 265358L);</div><div class="line">        alice.start();</div><div class="line">        bobby.start();</div><div class="line">        try &#123;</div><div class="line">            // 等待约10s</div><div class="line">            Thread.sleep(10000);</div><div class="line">        &#125; catch (InterruptedException e) &#123;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">        System.out.println(&quot;***** calling interrupt *****&quot;);</div><div class="line">        // 呼叫interrupt方法</div><div class="line">        alice.interrupt();</div><div class="line">        bobby.interrupt();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ol>
<li>Java多线程编程实战指南 – 黄文海</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/Java之不可变对象/" itemprop="url">
                  Java之不可变对象
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-25T14:45:03+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/25/Java之不可变对象/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/25/Java之不可变对象/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>多线程共享变量的情况下，为了保证数据一致性，往往需要对这些变量的访问进行加锁。而锁本身又会带来一些问题和开销。<code>Immutable Object</code>使得我们可以在不使用锁的情况下，既保证共享变量访问的线程安全，又能避免锁引入带来的问题和开销。</p>
<h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3><ol>
<li><strong>被建模对象的状态变化不频繁</strong></li>
<li><strong>同时对一组相关的数据进行写操作，需要保证原子性</strong></li>
<li><strong>使用某个对象作为安全的HashMap的Key</strong>，一个对象作为<code>HashMap</code>的Key被放入<code>HashMap</code>之后，若该对象状态变化导致了其<code>Hash Code</code>的变化，则会导致后面再同样的对象作为<code>Key</code>去<code>get</code>的时候无法获取关联的值，但由于不可变对象的状态不变，因此其<code>Hash Code</code>也不变。</li>
</ol>
<h3 id="需要注意的问题"><a href="#需要注意的问题" class="headerlink" title="需要注意的问题"></a>需要注意的问题</h3><ol>
<li>被建模对象的状态变更频繁，此时不见得不能使用不可变对象，只是状态变更需要频繁创建不可变对象，增加JVM垃圾回收。</li>
<li>防御性赋值，如果不可变对象本身包含一些状态需要对外暴露，而相应的字段本身又是可变的。那么返回这些字段的方法，还是需要做防御性复制，以避免外部代码修改了其内部的状态。</li>
</ol>
<h3 id="如何让类不可变"><a href="#如何让类不可变" class="headerlink" title="如何让类不可变"></a>如何让类不可变</h3><blockquote>
<p><a href="http://docs.oracle.com/javase/tutorial/essential/concurrency/imstrat.html" target="_blank" rel="external">JAVA文档，有关如何定义不可变类指南</a></p>
</blockquote>
<ol>
<li>不提供<code>setter</code>方法，setter方法用于修改属性和对象引用。这个原则阐述了在类定义的所有可变属性中，不提供setter方法，setter方法意味着你能够改变这个属性的状态，必须阻止提供setter方法。</li>
<li>所有的属性修饰添加<code>private</code>和<code>final</code>。这是另一种增加不可变的方式，属性声明为<code>private</code>为了在类之外不能够被访问到，final修饰符为了让你不能随便的改变他们。</li>
<li>不允许子类重写方法。最简单的方式声明类为final，final类不允许重写。</li>
<li>当属性中存在可变对象变量时，要特别留意。对象分为不可变和可变，当对象可变时，对可变对象的内容进行复制，并创建一个新对象赋值给它，这样保证可变对象的不可变。</li>
<li>定义一个private的构造方法，通过工厂方法构造对象。</li>
</ol>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p><strong>创建不可变类：ImmutableClass.class</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">package immutable;</div><div class="line"></div><div class="line">import java.util.Date;</div><div class="line"></div><div class="line">/**</div><div class="line">* Always remember that your instance variables will be either mutable or immutable.</div><div class="line">* Identify them and return new objects with copied content for all mutable objects.</div><div class="line">* Immutable variables can be returned safely without extra effort.</div><div class="line">* */</div><div class="line">public final class ImmutableClass</div><div class="line">&#123;</div><div class="line"></div><div class="line">    /**</div><div class="line">    * Integer class is immutable as it does not provide any setter to change its content</div><div class="line">    * */</div><div class="line">    private final Integer immutableField1;</div><div class="line">    /**</div><div class="line">    * String class is immutable as it also does not provide setter to change its content</div><div class="line">    * */</div><div class="line">    private final String immutableField2;</div><div class="line">    /**</div><div class="line">    * Date class is mutable as it provide setters to change various date/time parts</div><div class="line">    * */</div><div class="line">    private final Date mutableField;</div><div class="line"></div><div class="line">    //Default private constructor will ensure no unplanned construction of class</div><div class="line">    private ImmutableClass(Integer fld1, String fld2, Date date)</div><div class="line">    &#123;</div><div class="line">        this.immutableField1 = fld1;</div><div class="line">        this.immutableField2 = fld2;</div><div class="line">        this.mutableField = new Date(date.getTime());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //Factory method to store object creation logic in single place</div><div class="line">    public static ImmutableClass createNewInstance(Integer fld1, String fld2, Date date)</div><div class="line">    &#123;</div><div class="line">        return new ImmutableClass(fld1, fld2, date);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //Provide no setter methods</div><div class="line"></div><div class="line">    /**</div><div class="line">    * Integer class is immutable so we can return the instance variable as it is</div><div class="line">    * */</div><div class="line">    public Integer getImmutableField1() &#123;</div><div class="line">        return immutableField1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">    * String class is also immutable so we can return the instance variable as it is</div><div class="line">    * */</div><div class="line">    public String getImmutableField2() &#123;</div><div class="line">        return immutableField2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">    * Date class is mutable so we need a little care here.</div><div class="line">    * We should not return the reference of original instance variable.</div><div class="line">    * Instead a new Date object, with content copied to it, should be returned.</div><div class="line">    * */</div><div class="line">    public Date getMutableField() &#123;</div><div class="line">        return new Date(mutableField.getTime());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public String toString() &#123;</div><div class="line">        return immutableField1 +&quot; - &quot;+ immutableField2 +&quot; - &quot;+ mutableField;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>验证以上为不可变类：MainTest.class</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">import java.util.Date;</div><div class="line"></div><div class="line">public class MainTest &#123;</div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        ImmutableClass im = ImmutableClass.createNewInstance(100, &quot;test&quot;, new Date());</div><div class="line">        System.out.println(im);</div><div class="line">        tryModification(im.getImmutableField1(), im.getImmutableField2(), im.getMutableField());</div><div class="line">        System.out.println(im);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static void tryModification(Integer immutableField1, String immutableField2, Date mutableField) &#123;</div><div class="line">        immutableField1 = 10000;</div><div class="line">        immutableField2 = &quot;test changed&quot;;</div><div class="line">        mutableField.setDate(10);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>执行结果</strong></p>
<p>不可变对象包含(Integer、String、Date，其中Date为一个可变对象)，创建不可变对象后，更改入参的Date，并不会对不可变对象产生影响。故验证其为不可变对象类。</p>
<p><img src="http://oc5a5l0a0.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202016-09-25%20%E4%B8%8B%E5%8D%883.14.00.png" alt=""></p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ol>
<li><a href="http://howtodoinjava.com/core-java/related-concepts/how-to-make-a-java-class-immutable/" target="_blank" rel="external">how-to-make-a-java-class-immutable</a></li>
<li><a href="http://docs.oracle.com/javase/tutorial/essential/concurrency/imstrat.html" target="_blank" rel="external">Java官方文档-不可变类</a> </li>
<li>Java多线程编程实战指南(设计模式篇) - 黄文海 </li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/24/Java序列化/" itemprop="url">
                  Java序列化
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-24T22:46:34+08:00" content="2016-09-24">
              2016-09-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/24/Java序列化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/24/Java序列化/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="序列化是什么？"><a href="#序列化是什么？" class="headerlink" title="序列化是什么？"></a>序列化是什么？</h3><p>序列化是一种用来处理对象流的机制，所谓对象流就是将对象的内容进行流化，可以对流化后的对象进行读写操作，也可以将流化后的对象传输于网络之间。</p>
<p><code>序列化</code>：将数据分解成字节流，以便存储在文件中或在网络上传输。</p>
<p><code>反序列化</code>：打开字节流并重构对象。对象序列化不仅要将基本数据类型转换成字节表示，还有恢复数据的对象实例。</p>
<h3 id="序列化使用场景"><a href="#序列化使用场景" class="headerlink" title="序列化使用场景"></a>序列化使用场景</h3><ul>
<li>对象序列化可以实现分布式对象，如RMI要利用对象序列化运行远程主机上的服务，就像在本地机上运行对象一样。</li>
<li><code>JAVA</code>对象序列化不仅保留一个对象的数据，而且递归保存对象引用的每个对象的数据。可以将整个对象层次写入字节流中，可以保存在文件中或网络连接上传递。利用对象序列化可以进行对象的深复制，即复制对象本身及引用的对象本身。序列化一个对象可能得到整个对象序列。</li>
</ul>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p><strong> Employee序列化</strong></p>
<p><code>serialVersionUID序列化ID</code> ：序列化ID不同，对象是无法相互序列化和反序列化的。</p>
<p><code>transient</code> ： 在变量声明前加上该关键字，可以阻止该变量被序列化到文件中，在被反序列化后，transient 变量的值被设为初始值，如 int 型的是 0，对象型的是 null。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public class Employee implements Serializable &#123;</div><div class="line">    private static final long serialVersionUID = -5310833892778578686L;</div><div class="line">    private String name;</div><div class="line">    private String address;</div><div class="line">    private transient Integer SSN;</div><div class="line">    private Integer number;</div><div class="line">	</div><div class="line">	// 此处省略Getter &amp; Setter 方法</div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>将序列化对象赋值后存入文件中</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class SerializeDemo &#123;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Employee e = new Employee();</div><div class="line">        e.setAddress(&quot;上海&quot;);</div><div class="line">        e.setName(&quot;张三&quot;);</div><div class="line">        e.setSSN(123);</div><div class="line">        e.setNumber(123);</div><div class="line"></div><div class="line">        try &#123;</div><div class="line">            FileOutputStream fileOut = new FileOutputStream(&quot;/tmp/employee.ser&quot;);</div><div class="line">            ObjectOutputStream out = new ObjectOutputStream(fileOut);</div><div class="line">            out.writeObject(e);</div><div class="line">            out.close();</div><div class="line">            fileOut.close();</div><div class="line">            System.out.printf(&quot;Serialized data is saved in /tmp/employee.ser&quot;);</div><div class="line">        &#125; catch (IOException i) &#123;</div><div class="line">            i.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>查看存入文件中的序列化对象</strong></p>
<p><img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-24/99793188.jpg" alt=""></p>
<p><strong>从文件中反序列化字节码为Employee对象</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class DeserializeDemo &#123;</div><div class="line"></div><div class="line">   public static void main(String [] args) &#123;</div><div class="line">      Employee e = null;</div><div class="line">      try &#123;</div><div class="line">         FileInputStream fileIn = new FileInputStream(&quot;/tmp/employee.ser&quot;);</div><div class="line">         ObjectInputStream in = new ObjectInputStream(fileIn);</div><div class="line">         e = (Employee) in.readObject();</div><div class="line">         in.close();</div><div class="line">         fileIn.close();</div><div class="line">      &#125;catch(IOException i) &#123;</div><div class="line">         i.printStackTrace();</div><div class="line">         return;</div><div class="line">      &#125;catch(ClassNotFoundException c) &#123;</div><div class="line">         System.out.println(&quot;Employee class not found&quot;);</div><div class="line">         c.printStackTrace();</div><div class="line">         return;</div><div class="line">      &#125;</div><div class="line">      System.out.println(&quot;Employee&quot; + JSON.toJSONString(e));</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>反序列化结果</strong></p>
<p>被声明为<code>transient</code>的<code>SSN</code>属性没有序列化，故没有反序列化出来。</p>
<p><img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-24/15700843.jpg" alt=""></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol>
<li>一个类进行序列化和反序列化其序列化ID必须一致，否则将出错。</li>
<li>子类实现序列化接口，父类未实现序列化接口，反序列化中，父类的属性与序列化不一致，解决办法，将父类也实现序列化接口。</li>
<li>对于对象中不需要序列化的属性前加<code>transient</code>关键字</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/23/SpringBoot中的事务管理/" itemprop="url">
                  SpringBoot中的事务管理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-23T00:24:19+08:00" content="2016-09-23">
              2016-09-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringBoot/" itemprop="url" rel="index">
                    <span itemprop="name">SpringBoot</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/23/SpringBoot中的事务管理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/23/SpringBoot中的事务管理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>在项目应用开发时，用户一个操作实际是对数据读写的多步操作的结合，由于数据操作在顺序执行的过程中，任何一步操作都有可能发生异常，异常会导致后续操作无法完成，此时由于业务逻辑并没有正确完成，之前成功操作数据并不可靠，需要在这种情况下进行回退。</p>
<h3 id="事务的作用"><a href="#事务的作用" class="headerlink" title="事务的作用"></a>事务的作用</h3><p>事务是为了保证用户的每一个操作都是可靠的，事务中的每一步操作都必须成功执行，只要有异常发生就回退到事务刚开始未进行操作的状态；事务管理是Spring框架中最为常用的功能之一，我们在使用SpringBoot开发时，大部分情况下也都需要使用事务；</p>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p>未完待续….</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/18/SpringBoot中使用JavaMailSender发送邮件/" itemprop="url">
                  SpringBoot中使用JavaMailSender发送邮件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-18T23:13:10+08:00" content="2016-09-18">
              2016-09-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringBoot/" itemprop="url" rel="index">
                    <span itemprop="name">SpringBoot</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/18/SpringBoot中使用JavaMailSender发送邮件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/18/SpringBoot中使用JavaMailSender发送邮件/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>使用过Spring的开发者都知道Spring提供了非常好用的<code>JavaMailSender</code>接口实现邮件发送，在SpringBoot的Starter模块中也为此提供了自动化配置。</p>
<h3 id="实战1-发送简单邮件-项目的Git链接"><a href="#实战1-发送简单邮件-项目的Git链接" class="headerlink" title="实战1:发送简单邮件 项目的Git链接"></a>实战1:发送简单邮件 <a href="http://git.oschina.net/shuangziliuyun/SpringBoot-Learning/tree/master/SpringMailSenderDemo?dir=1&amp;filepath=SpringMailSenderDemo&amp;oid=56c7fdd75afebd32f0bb1aa71da5349f0cd42d70&amp;sha=4940a0702b65b0ce4022441ad12f4be49824374e" target="_blank" rel="external">项目的Git链接</a></h3><p><strong>1.创建SpringBoot工程，并引入<code>spring-boot-starter-mail</code>依赖</strong></p>
<p><code>pom.xml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div class="line"></div><div class="line">    &lt;groupId&gt;com.dada&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;springmailsenderdemo&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</div><div class="line">    &lt;packaging&gt;jar&lt;/packaging&gt;</div><div class="line"></div><div class="line">    &lt;name&gt;SpringMailSenderDemo&lt;/name&gt;</div><div class="line">    &lt;description&gt;SpringMailSenderDemo&lt;/description&gt;</div><div class="line"></div><div class="line">    &lt;parent&gt;</div><div class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;1.4.0.RELEASE&lt;/version&gt;</div><div class="line">        &lt;relativePath/&gt;</div><div class="line">    &lt;/parent&gt;</div><div class="line"></div><div class="line">    &lt;properties&gt;</div><div class="line">        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</div><div class="line">        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;</div><div class="line">        &lt;java.version&gt;1.8&lt;/java.version&gt;</div><div class="line">    &lt;/properties&gt;</div><div class="line">	</div><div class="line">    &lt;dependencies&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line"></div><div class="line">        &lt;!--mail--&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line"></div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</div><div class="line">            &lt;scope&gt;test&lt;/scope&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">    &lt;/dependencies&gt;</div><div class="line"></div><div class="line">    &lt;build&gt;</div><div class="line">        &lt;plugins&gt;</div><div class="line">            &lt;plugin&gt;</div><div class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</div><div class="line">            &lt;/plugin&gt;</div><div class="line">        &lt;/plugins&gt;</div><div class="line">    &lt;/build&gt;</div><div class="line">&lt;/project&gt;</div></pre></td></tr></table></figure>
<p><strong>2.在<code>application.properties</code>配置相应属性内容(注意替换<code>username</code> &amp; <code>password</code>)</strong></p>
<p><code>application.properties</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">spring.mail.host=smtp.163.com</div><div class="line">spring.mail.username=username@163.com</div><div class="line">spring.mail.password=password</div><div class="line">spring.mail.properties.mail.smtp.auth=true</div><div class="line">spring.mail.properties.mail.smtp.starttls.enable=true</div><div class="line">spring.mail.properties.mail.smtp.starttls.required=true</div></pre></td></tr></table></figure>
<p><strong>3.单元测试实现简单一封邮件的发送</strong></p>
<p><code>MailTest.class</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">@RunWith(SpringJUnit4ClassRunner.class)</div><div class="line">@SpringBootTest</div><div class="line">public class MailTest &#123;</div><div class="line"></div><div class="line">    @Autowired</div><div class="line">    private JavaMailSender javaMailSender;</div><div class="line"></div><div class="line">    @Test</div><div class="line">    public void sendSimpleMail()&#123;</div><div class="line">        SimpleMailMessage message = new SimpleMailMessage();</div><div class="line">        message.setFrom(&quot;soso_jwl@163.com&quot;);</div><div class="line">        message.setTo(&quot;soso_jwl@163.com&quot;);</div><div class="line">        message.setSubject(&quot;主题:这是一份测试邮件&quot;);</div><div class="line">        message.setText(&quot;测试邮件内容&quot;);</div><div class="line"></div><div class="line">        javaMailSender.send(message);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>4.遇到的问题</strong></p>
<p>最开始用QQ邮箱来测试，<code>application.properties</code>中邮件服务器更改为<code>spring.mail.host=smtp.qq.com</code>,出现以下错误：<img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-18/24716938.jpg" alt=""></p>
<p><code>解决方案：</code>更改邮箱服务器为163的，用163邮箱测试。</p>
<p><strong>5.测试的结果</strong></p>
<p><img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-18/11547717.jpg" alt=""></p>
<h3 id="实战2：发送带附件的邮件"><a href="#实战2：发送带附件的邮件" class="headerlink" title="实战2：发送带附件的邮件"></a>实战2：发送带附件的邮件</h3><p><code>测试用例:MailTest.class</code></p>
<p>发送一份带两个附件的邮件耗时<code>2.5s</code>，每个附件为400k的照片。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">@RunWith(SpringJUnit4ClassRunner.class)</div><div class="line">@SpringBootTest</div><div class="line">public class MailTest &#123;</div><div class="line"></div><div class="line">    @Autowired</div><div class="line">    private JavaMailSender javaMailSender;</div><div class="line"></div><div class="line">    @Test</div><div class="line">    public void sendAttachmentsMail() throws MessagingException &#123;</div><div class="line">        Long start = System.currentTimeMillis();</div><div class="line"></div><div class="line">        MimeMessage mimeMessage = javaMailSender.createMimeMessage();</div><div class="line"></div><div class="line">        MimeMessageHelper helper = new MimeMessageHelper(mimeMessage,true);</div><div class="line">        helper.setFrom(&quot;soso_jwl@163.com&quot;);</div><div class="line">        helper.setTo(&quot;soso_jwl@163.com&quot;);</div><div class="line">        helper.setSubject(&quot;主题:这是带附件的测试邮件&quot;);</div><div class="line">        helper.setText(&quot;附件...&quot;);</div><div class="line"></div><div class="line">        FileSystemResource file = new FileSystemResource(new File(&quot;my.png&quot;));</div><div class="line">        helper.addAttachment(&quot;附件-1.png&quot;,file);</div><div class="line">        helper.addAttachment(&quot;附件-2.png&quot;,file);</div><div class="line"></div><div class="line">        javaMailSender.send(mimeMessage);</div><div class="line"></div><div class="line">        System.out.println(&quot;SPEND TIME ==&gt; &quot; + (System.currentTimeMillis() - start));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>测试结果</code></p>
<p><img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-18/76088226.jpg" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/17/SpringBoot中使用-Async实现异步调用/" itemprop="url">
                  SpringBoot中使用@Async实现异步调用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-17T22:14:27+08:00" content="2016-09-17">
              2016-09-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringBoot/" itemprop="url" rel="index">
                    <span itemprop="name">SpringBoot</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/17/SpringBoot中使用-Async实现异步调用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/17/SpringBoot中使用-Async实现异步调用/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="什么是异步调用"><a href="#什么是异步调用" class="headerlink" title="什么是异步调用"></a>什么是异步调用</h3><p><code>异步调用</code>对应的是<code>同步调用</code>，<code>同步调用</code>指程序按照定义顺序依次执行，每一行程序都必须等待上一行程序执行完成之后才能执行；<code>异步调用</code>指程序在顺序执行时，不等待异步调用返回的结果，就执行后面的程序了。</p>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p><strong>案例1：同步调用</strong></p>
<p>创建三个处理函数分别模拟三个执行任务的操作，操作耗时随机取(10s内)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">@Component</div><div class="line">public class Task &#123;</div><div class="line">    public static Random random =new Random();</div><div class="line"></div><div class="line">    public void doTaskOne() throws Exception &#123;</div><div class="line">        System.out.println(&quot;开始做任务一&quot;);</div><div class="line">        long start = System.currentTimeMillis();</div><div class="line">        Thread.sleep(random.nextInt(10000));</div><div class="line">        long end = System.currentTimeMillis();</div><div class="line">        System.out.println(&quot;完成任务一，耗时：&quot; + (end - start) + &quot;毫秒&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void doTaskTwo() throws Exception &#123;</div><div class="line">        System.out.println(&quot;开始做任务二&quot;);</div><div class="line">        long start = System.currentTimeMillis();</div><div class="line">        Thread.sleep(random.nextInt(10000));</div><div class="line">        long end = System.currentTimeMillis();</div><div class="line">        System.out.println(&quot;完成任务二，耗时：&quot; + (end - start) + &quot;毫秒&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void doTaskThree() throws Exception &#123;</div><div class="line">        System.out.println(&quot;开始做任务三&quot;);</div><div class="line">        long start = System.currentTimeMillis();</div><div class="line">        Thread.sleep(random.nextInt(10000));</div><div class="line">        long end = System.currentTimeMillis();</div><div class="line">        System.out.println(&quot;完成任务三，耗时：&quot; + (end - start) + &quot;毫秒&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>测试方法：</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@RunWith(SpringJUnit4ClassRunner.class)</div><div class="line">@SpringBootTest</div><div class="line">public class TaskTest &#123;</div><div class="line"></div><div class="line">    @Autowired</div><div class="line">    private Task task;</div><div class="line"></div><div class="line">    @Test</div><div class="line">    public void taskExec() throws Exception &#123;</div><div class="line">        task.doTaskOne();</div><div class="line">        task.doTaskTwo();</div><div class="line">        task.doTaskThree();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>执行结果:</code></p>
<p><img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-17/44690361.jpg" alt=""></p>
<p><strong>案例2：异步调用</strong></p>
<p><code>在Spring Boot的主程序增加@EnableAsyn，为了让@Async注解生效</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@EnableAsync</div><div class="line">@SpringBootApplication</div><div class="line">public class SpringDemoApplication &#123;</div><div class="line"></div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		SpringApplication.run(SpringDemoApplication.class, args);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>三个异步调用函数：AsyncTask.class</code></p>
<p>特别注意：@Async所修饰的函数不要定义为static类型，这样异步调用不会生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">@Component</div><div class="line">public class AsyncTask &#123;</div><div class="line">    public static Random random =new Random();</div><div class="line"></div><div class="line">    @Async</div><div class="line">    public Future&lt;String&gt; doTaskOne() throws Exception &#123;</div><div class="line">        System.out.println(&quot;开始做任务一&quot;);</div><div class="line">        long start = System.currentTimeMillis();</div><div class="line">        Thread.sleep(random.nextInt(10000));</div><div class="line">        long end = System.currentTimeMillis();</div><div class="line">        System.out.println(&quot;完成任务一，耗时：&quot; + (end - start) + &quot;毫秒&quot;);</div><div class="line"></div><div class="line">        return new AsyncResult&lt;&gt;(&quot;任务一已完成!!!&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Async</div><div class="line">    public Future&lt;String&gt; doTaskTwo() throws Exception &#123;</div><div class="line">        System.out.println(&quot;开始做任务二&quot;);</div><div class="line">        long start = System.currentTimeMillis();</div><div class="line">        Thread.sleep(random.nextInt(10000));</div><div class="line">        long end = System.currentTimeMillis();</div><div class="line">        System.out.println(&quot;完成任务二，耗时：&quot; + (end - start) + &quot;毫秒&quot;);</div><div class="line">        return new AsyncResult&lt;&gt;(&quot;任务二已完成!!!&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Async</div><div class="line">    public Future&lt;String&gt; doTaskThree() throws Exception &#123;</div><div class="line">        System.out.println(&quot;开始做任务三&quot;);</div><div class="line">        long start = System.currentTimeMillis();</div><div class="line">        Thread.sleep(random.nextInt(10000));</div><div class="line">        long end = System.currentTimeMillis();</div><div class="line">        System.out.println(&quot;完成任务三，耗时：&quot; + (end - start) + &quot;毫秒&quot;);</div><div class="line">        return new AsyncResult&lt;&gt;(&quot;任务三已完成!!!&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>执行的结果：</code></p>
<p><img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-17/20718204.jpg" alt=""></p>
<p><code>分析</code></p>
<p>对比<code>同步调用</code>和<code>异步调用</code>案例，很明显，异步调用让任务1、2、3并发执行，有效的减少了程序的总运行时间。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/17/SpringBoot使用AOP统一处理Web请求日志/" itemprop="url">
                  SpringBoot使用AOP统一处理Web请求日志
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-17T16:50:46+08:00" content="2016-09-17">
              2016-09-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SpringBoot/" itemprop="url" rel="index">
                    <span itemprop="name">SpringBoot</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/17/SpringBoot使用AOP统一处理Web请求日志/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/17/SpringBoot使用AOP统一处理Web请求日志/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p><code>Spring</code>有两个重要的特性一个是<code>IOC</code>,另一个<code>AOP</code>。<code>IOC</code>在Spring项目中被广泛使用，<code>AOP</code>却是一个盲点。今日初探<code>AOP</code>,深深感觉到它的强大。本文主要讲解在SpringBoot中引入Aop功能 &amp; 使用AOP做切面去统一处理Web请求日志。</p>
<h3 id="AOP是什么？"><a href="#AOP是什么？" class="headerlink" title="AOP是什么？"></a><code>AOP</code>是什么？</h3><p><code>AOP</code>为<code>Aspect Oriented Programming</code>的缩写，意为面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。<code>AOP</code>通过对既有程序定义一个切入点，然后在其前后切入不同的执行内容，比如常见的有：打开数据库连接 &amp; 关闭数据库连接 &amp; 打开事务 &amp; 关闭事务 &amp; 记录日志等。基于AOP不会破坏原来程序逻辑，因此它可以很好地对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p>
<h3 id="实战-项目Git链接"><a href="#实战-项目Git链接" class="headerlink" title="实战 项目Git链接"></a>实战 <a href="http://git.oschina.net/shuangziliuyun/SpringBoot-Learning/tree/master/SpringAopDemo?dir=1&amp;filepath=SpringAopDemo&amp;oid=006ff95faa36663be27ce9d0ae93f8058ec82901&amp;sha=4940a0702b65b0ce4022441ad12f4be49824374e" target="_blank" rel="external">项目Git链接</a></h3><p><strong>1.搭建本地SpringBoot项目</strong></p>
<p><code>pom.xml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">	xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</div><div class="line">	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</div><div class="line"></div><div class="line">	&lt;groupId&gt;com.dada&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;springaopdemo&lt;/artifactId&gt;</div><div class="line">	&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</div><div class="line">	&lt;packaging&gt;jar&lt;/packaging&gt;</div><div class="line"></div><div class="line">	&lt;name&gt;SpringAopDemo&lt;/name&gt;</div><div class="line">	&lt;description&gt;SpringAopDemo&lt;/description&gt;</div><div class="line"></div><div class="line">	&lt;parent&gt;</div><div class="line">		&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">		&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</div><div class="line">		&lt;version&gt;1.4.0.RELEASE&lt;/version&gt;</div><div class="line">		&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</div><div class="line">	&lt;/parent&gt;</div><div class="line"></div><div class="line">	&lt;properties&gt;</div><div class="line">		&lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</div><div class="line">		&lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;</div><div class="line">		&lt;java.version&gt;1.8&lt;/java.version&gt;</div><div class="line">	&lt;/properties&gt;</div><div class="line"></div><div class="line">	&lt;dependencies&gt;</div><div class="line">		&lt;!--lombok--&gt;</div><div class="line">		&lt;dependency&gt;</div><div class="line">			&lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</div><div class="line">			&lt;artifactId&gt;lombok&lt;/artifactId&gt;</div><div class="line">			&lt;version&gt;1.16.10&lt;/version&gt;</div><div class="line">		&lt;/dependency&gt;</div><div class="line"></div><div class="line">		&lt;!--fast json--&gt;</div><div class="line">		&lt;dependency&gt;</div><div class="line">			&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</div><div class="line">			&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</div><div class="line">			&lt;version&gt;1.2.17&lt;/version&gt;</div><div class="line">		&lt;/dependency&gt;</div><div class="line"></div><div class="line">		&lt;!--springBoot--&gt;</div><div class="line">		&lt;dependency&gt;</div><div class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div class="line">		&lt;/dependency&gt;</div><div class="line"></div><div class="line">		&lt;!--AOP--&gt;</div><div class="line">		&lt;dependency&gt;</div><div class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">			&lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</div><div class="line">		&lt;/dependency&gt;</div><div class="line"></div><div class="line">		&lt;!--Log4j--&gt;</div><div class="line">		&lt;dependency&gt;</div><div class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">			&lt;artifactId&gt;spring-boot-starter-log4j&lt;/artifactId&gt;</div><div class="line">		&lt;/dependency&gt;</div><div class="line"></div><div class="line">		&lt;dependency&gt;</div><div class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</div><div class="line">			&lt;scope&gt;test&lt;/scope&gt;</div><div class="line">		&lt;/dependency&gt;</div><div class="line">	&lt;/dependencies&gt;</div><div class="line"></div><div class="line">	&lt;build&gt;</div><div class="line">		&lt;plugins&gt;</div><div class="line">			&lt;plugin&gt;</div><div class="line">				&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">				&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</div><div class="line">			&lt;/plugin&gt;</div><div class="line">		&lt;/plugins&gt;</div><div class="line">	&lt;/build&gt;</div><div class="line">&lt;/project&gt;</div></pre></td></tr></table></figure>
<p><code>Controller层：AdminController.class</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@RestController</div><div class="line">@RequestMapping(value = &quot;/admin&quot;)</div><div class="line">public class AdminController &#123;</div><div class="line">    @RequestMapping(value = &quot;/info&quot;,method = RequestMethod.GET)</div><div class="line">    public String info(@RequestParam String username, @RequestParam String password)&#123;</div><div class="line">        return JSON.toJSONString(new Admin(username,password));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>数据模型:Admin.class</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Data</div><div class="line">public class Admin &#123;</div><div class="line">    private final String username;</div><div class="line">    private final String password;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>至此，我们实现了一个简单请求处理，通入<code>username</code> &amp; <code>password</code>，返回<code>Admin</code>的JSON字符串。下面我们可以对上面的<code>/admin/info</code>请求，进行切面日志记录。</p>
<p><strong>Web层的日志切面</strong></p>
<p>SpringBoot中默认是开启AOP的，所以不需要增加<code>@EnableAspectJAutoProxy</code>注解。而当我们需要使用<code>CGLIB</code>来实现AOP的时候，需要配置<code>spring.aop.proxy-target-class=true</code>，不然默认使用的是标准<code>Java</code>的实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># AOP</div><div class="line">spring.aop.auto=true # Add @EnableAspectJAutoProxy.</div><div class="line">spring.aop.proxy-target-class=false # Whether subclass-based (CGLIB) proxies are to be created (true) as</div><div class="line"> opposed to standard Java interface-based proxies (false).</div></pre></td></tr></table></figure>
<p><code>AOP切面的几个要素</code></p>
<ul>
<li><code>@Aspect</code>注解将Java类定义为切面类</li>
<li><code>@Pointcut</code>注解定义一个切入点，切入点的表达式筛选规则<code>execution(&lt;方法修饰符&gt; ? &lt;方法返回值类型&gt; &lt;包名&gt;.&lt;类名&gt;.&lt;方法名&gt;(&lt;参数类型&gt;) [throws &lt;异常类型&gt;]?)</code>;<br><code>*</code>代表0个或多个任意字符 &amp; 包名中<code>..</code>代表当前包及其子包 &amp; 参数列表中<code>..</code>代表任意个参数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@Pointcut(&quot;execution(public * com.dada.controller..*.*(..))&quot;)</div><div class="line">  public void webLog()&#123;&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>@Before</code>在切入点开始处切入内容</li>
<li><code>@After</code>在切入点结尾处切入内容</li>
<li><code>@AfterReturning</code>在切入点return内容之后，切入内容。可以对处理返回值做些加工处理</li>
<li><code>@Around</code>在切入点前后切入内容，并自己控制何时执行切入点自身的内容。</li>
<li><code>@AfterThrowing</code>用来处理当切入内容部分抛出异常之后的处理逻辑</li>
</ul>
<p><code>声明切面类：WebLogAspect.class</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">@Aspect</div><div class="line">@Component</div><div class="line">public class WebLogAspect &#123;</div><div class="line">    private Logger logger = Logger.getLogger(getClass());</div><div class="line"></div><div class="line">    @Pointcut(&quot;execution(public * com.dada.controller..*.*(..))&quot;)</div><div class="line">    public void webLog()&#123;&#125;</div><div class="line"></div><div class="line">    @Before(&quot;webLog()&quot;)</div><div class="line">    public void doBefore(JoinPoint joinPoint) throws Throwable &#123;</div><div class="line">        // 接收到请求，记录请求内容</div><div class="line">        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</div><div class="line">        HttpServletRequest request = attributes.getRequest();</div><div class="line">        // 记录下请求内容</div><div class="line">        logger.info(&quot;URL : &quot; + request.getRequestURL().toString());</div><div class="line">        logger.info(&quot;HTTP_METHOD : &quot; + request.getMethod());</div><div class="line">        logger.info(&quot;IP : &quot; + request.getRemoteAddr());</div><div class="line">        logger.info(&quot;CLASS_METHOD : &quot; + joinPoint.getSignature().getDeclaringTypeName() + &quot;.&quot; + joinPoint.getSignature().getName());</div><div class="line">        logger.info(&quot;ARGS : &quot; + Arrays.toString(joinPoint.getArgs()));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @AfterReturning(returning = &quot;ret&quot;, pointcut = &quot;webLog()&quot;)</div><div class="line">    public void doAfterReturning(Object ret) throws Throwable &#123;</div><div class="line">        // 处理完请求，返回内容</div><div class="line">        logger.info(&quot;RESPONSE : &quot; + ret);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>请求”/admin/info”接口，得到以下日志信息：<br><img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-17/22783585.jpg" alt=""></p>
<h3 id="AOP切面中的同步问题"><a href="#AOP切面中的同步问题" class="headerlink" title="AOP切面中的同步问题"></a>AOP切面中的同步问题</h3><p>在WebLogAspect切面中，分别通过<code>doBefore</code> &amp; <code>doAfterReturning</code>两个独立函数实现了切点头部和切点返回后执行的内容，若我们想统计请求的处理时间，就需要在doBefore出记录时间，并在doAfterReturning处通过当前时间与开始处的时间计算得到请求处理的消耗时间。</p>
<p>那么我们是否可以在WebLogAspect切面中定义一个成员变量来给doBefore和doAfterReturning一起访问呢？是否会有同步问题呢？</p>
<p>直接在这里定义基本类型肯定会有同步问题，所以我们引入ThreadLocal对象，以这种方式记录，就可以解决同步的问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">@Aspect</div><div class="line">@Component</div><div class="line">public class WebLogAspect &#123;</div><div class="line">    private Logger logger = Logger.getLogger(getClass());</div><div class="line">    </div><div class="line">    ThreadLocal&lt;Long&gt; start = new ThreadLocal&lt;&gt;();</div><div class="line"></div><div class="line">    @Pointcut(&quot;execution(public * com.dada.controller..*.*(..))&quot;)</div><div class="line">    public void webLog()&#123;&#125;</div><div class="line"></div><div class="line">    @Before(&quot;webLog()&quot;)</div><div class="line">    public void doBefore(JoinPoint joinPoint) throws Throwable &#123;</div><div class="line">        start.set(System.currentTimeMillis());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @AfterReturning(returning = &quot;ret&quot;, pointcut = &quot;webLog()&quot;)</div><div class="line">    public void doAfterReturning(Object ret) throws Throwable &#123;</div><div class="line">        // 处理完请求，返回内容</div><div class="line">        logger.info(&quot;RESPONSE : &quot; + ret);</div><div class="line">        logger.info(&quot;SPEND TIME:&quot; + System.currentTimeMillis() - start.get());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="AOP切面的优先级"><a href="#AOP切面的优先级" class="headerlink" title="AOP切面的优先级"></a>AOP切面的优先级</h3><p>由于通过AOP实现，程序得到了很好地解耦，但也会带来一些问题，比如我们可能会对Web层做多个切面，校验用户，校验头信息等等，这个时候会碰到切面的处理顺序问题。</p>
<p>所以，我们需要定义每个切面的优先级，我们需要<code>@Order(i)</code>注解来标识切面的优先级，i的值越小，优先级越高。假设我们还有一个切面是<code>CheckNameAspect</code>用来校验name必须是liuyun，我们为其设置<code>@Order(10)</code>,而上文中WebLogAspect设置为<code>@Order(5)</code>所以WebLogAspect有更高的优先级，这个时候的执行顺序是这样的；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@Before中`@Order(5)`的内容 -&gt; @Before中`@Order(10)`的内容 -&gt; `@After`和`@AfterReturning`中`@Order(10)`的内容 -&gt; `@After`和`@AfterReturning`中`@Order(5)`的内容</div></pre></td></tr></table></figure>
<p>故得到这样的结论:</p>
<ul>
<li>切入点前的操作，按Order的值由小到大执行；</li>
<li>切入点后的操作，按Order的值由大到小执行；</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/17/Retrofit入门/" itemprop="url">
                  Retrofit入门
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-17T10:43:48+08:00" content="2016-09-17">
              2016-09-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Retrofit/" itemprop="url" rel="index">
                    <span itemprop="name">Retrofit</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/17/Retrofit入门/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/17/Retrofit入门/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Retrofit简介"><a href="#Retrofit简介" class="headerlink" title="Retrofit简介"></a><code>Retrofit</code>简介</h3><p><code>Retrofit</code>是<code>Square</code>公司开发的一个类型安全的<code>Java</code> &amp; <code>Android</code>的<code>REST</code>客户端库，这个库为网路认证、API请求以及用<code>OkHttp</code>发送网络请求提供了强大的框架。<code>Retrofit</code>库使得从<code>Web API</code>下载<code>JSON</code> 或者 <code>XML</code>数据变得非常简单直接，一旦数据下载完成即将其解析成普通的<code>Java</code>类(<code>POJO</code>).</p>
<p><code>Retrofit</code>使用的最核心的两个技术是：动态代理和<code>Java</code>反射。<code>Retrofit</code>非常巧妙的用注解来描述<code>HTTP</code>请求，将一个<code>HTTP</code>请求抽象成一个<code>Java</code>接口，然后用<code>Java</code>动态代理的方式，动态的将这个接口的注解“解释”成一个<code>HTTP</code>请求，最后在执行这个HTTP请求。</p>
<p><code>Retrofit</code>无非是让用户创建接口，并在接口中指定网络访问路径、规则，把接口传入<code>Retrofit</code>；<code>Retrofit</code>进行解析，然后调用<code>OkHttp</code>完成实际的网络请求并将请求结果处理后返回给用户。</p>
<p>另：<code>Retrofit</code>支持<code>Java 7</code>或<code>Android2.3</code>以上版本</p>
<h3 id="Retrofit优势"><a href="#Retrofit优势" class="headerlink" title="Retrofit优势"></a><code>Retrofit</code>优势</h3><ol>
<li>底层使用<code>OkHttp</code>进行网络传输，性能好、速度快</li>
<li>拥有出色的<code>API</code>文档和社区支持</li>
<li>自动将<code>REST API</code>返回的数据转化为<code>Java</code>对象，且支持多种数据格式转换(<code>JSON</code>、<code>XML</code>…) </li>
<li>使用<code>Java</code>注解声明<code>HTTP</code>请求</li>
<li>支持<code>Multipart</code>请求和文件上传</li>
</ol>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p><strong>1.搭建本地测试服务,以<code>SpringBoot</code>框架为例</strong></p>
<p><code>Controller层：AdminController.class</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@RestController</div><div class="line">@RequestMapping(value = &quot;/admin&quot;)</div><div class="line">public class AdminController &#123;</div><div class="line">    @RequestMapping(value = &quot;/get&quot;,method = RequestMethod.GET)</div><div class="line">    public JsonResult&lt;Admin&gt; get(@RequestParam String name, @RequestParam String password)&#123;</div><div class="line">        return JsonResult.ok(new Admin(name,password));</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><code>对象模型: Admin.class</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// 注： @Data为lombok插件注解，表示Getter &amp; Setter 方法，声明为final类型的属性为构造方法属性，详情可以参考[lombok官网](https://projectlombok.org/) </div><div class="line"></div><div class="line">@Data</div><div class="line">public class Admin &#123;</div><div class="line">    private final String name;</div><div class="line">    private final String password;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>工具类:JsonResult.class</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">@Data</div><div class="line">public class JsonResult&lt;T&gt; &#123;</div><div class="line"></div><div class="line">    private boolean success;</div><div class="line"></div><div class="line">    @JsonInclude(JsonInclude.Include.NON_NULL)</div><div class="line">    private T data;</div><div class="line"></div><div class="line">    @JsonInclude(JsonInclude.Include.NON_NULL)</div><div class="line">    private Integer errorCode;</div><div class="line"></div><div class="line">    @JsonInclude(JsonInclude.Include.NON_NULL)</div><div class="line">    private String errorMessage;</div><div class="line"></div><div class="line">    public static &lt;T&gt; JsonResult&lt;T&gt; ok() &#123;</div><div class="line">        JsonResult&lt;T&gt; result = new JsonResult&lt;&gt;();</div><div class="line">        result.setSuccess(true);</div><div class="line">        return result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static &lt;T&gt; JsonResult&lt;T&gt; ok(T data) &#123;</div><div class="line">        JsonResult&lt;T&gt; result = new JsonResult&lt;&gt;();</div><div class="line">        result.setSuccess(true);</div><div class="line">        result.setData(data);</div><div class="line">        return result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static &lt;T&gt; JsonResult&lt;T&gt; error(Code code) &#123;</div><div class="line">        JsonResult&lt;T&gt; result = new JsonResult&lt;&gt;();</div><div class="line">        result.setErrorCode(code.getCode());</div><div class="line">        result.setErrorMessage(code.getMessage());</div><div class="line">        return result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static &lt;T&gt; JsonResult&lt;T&gt; error(String message) &#123;</div><div class="line">        JsonResult&lt;T&gt; result = new JsonResult&lt;&gt;();</div><div class="line">        result.setErrorCode(SERVER_ERROR.getCode());</div><div class="line">        result.setErrorMessage(message);</div><div class="line">        return result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static &lt;T&gt; JsonResult&lt;T&gt; error() &#123;</div><div class="line">        JsonResult&lt;T&gt; result = new JsonResult&lt;&gt;();</div><div class="line">        result.setErrorCode(SERVER_ERROR.getCode());</div><div class="line">        result.setErrorMessage(SERVER_ERROR.getMessage());</div><div class="line">        return result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static &lt;T&gt; JsonResult&lt;T&gt; error(Integer code ,String message) &#123;</div><div class="line">        JsonResult&lt;T&gt; result = new JsonResult&lt;&gt;();</div><div class="line">        result.setErrorCode(code);</div><div class="line">        result.setErrorMessage(message);</div><div class="line">        return result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>错误常量枚举：Code.class</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">// 注: @Getter 为lombok插件注解 功能与Getter方法等价</div><div class="line">@Getter</div><div class="line">public enum Code &#123;</div><div class="line">    // 基础响应码</div><div class="line">    SERVER_ERROR(1, &quot;服务异常&quot;),</div><div class="line">    BASE_NOT_FOUND(2, &quot;资源不存在&quot;),</div><div class="line">    BASE_UNAUTHORIZED(3, &quot;未授权&quot;),</div><div class="line">    BASE_FORBIDDEN(4, &quot;拒绝访问&quot;),</div><div class="line">    BASE_BAD_PARAMS(5, &quot;请求参数错误&quot;);</div><div class="line"></div><div class="line">    private int code;</div><div class="line">    private String message;</div><div class="line"></div><div class="line">    Code(int code, String message) &#123;</div><div class="line">        this.message = message;</div><div class="line">        this.code = code;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>2. Retrofit运用实例</strong></p>
<p><code>将网络请求API转换为一个Java接口: UserApi.class</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface AdminApi &#123;</div><div class="line">    @GET(&quot;/admin/get&quot;)</div><div class="line">    Call&lt;JsonResult&lt;Admin&gt;&gt; get(@Query(&quot;name&quot;) String name, @Query(&quot;password&quot;) String password);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>Retrofit生成UserApi接口实现 &amp; 创建同步远程请求:RetrofitBootStrap.class</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public class RetrofitBootStrap &#123;</div><div class="line">    private static final String LOCAL_HOST = &quot;http://127.0.0.1:8080&quot;;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        Retrofit retrofit = new Retrofit.Builder().baseUrl(LOCAL_HOST)</div><div class="line">                .addConverterFactory(GsonConverterFactory.create())</div><div class="line">                .build();</div><div class="line"></div><div class="line">        // retrofit生成UserApi接口实现</div><div class="line">        UserApi service = retrofit.create(AdminApi.class);</div><div class="line"></div><div class="line">        Call&lt;JsonResult&lt;Admin&gt;&gt; postMsg = service.get(&quot;zhangsan&quot;, &quot;123456&quot;);</div><div class="line">        try &#123;</div><div class="line">            // 创建同步远程请求</div><div class="line">            System.out.println(JSON.toJSONString(postMsg.execute().body()));</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>3.执行步骤</strong></p>
<ol>
<li>启动<code>SpringBoot</code>，将本地测试服务开启来；</li>
<li>执行<code>RetrofitBootStrap.class</code>的<code>main</code>方法，请求本地测试服务的<code>/admin/get的请求路径接口</code>，得到相应结果为：<br><img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-17/72733150.jpg" alt=""></li>
</ol>
<h3 id="Retrofit知识点"><a href="#Retrofit知识点" class="headerlink" title="Retrofit知识点"></a>Retrofit知识点</h3><p><strong>注解</strong></p>
<p><code>案例1：GET请求路径带路径参数</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@GET(&quot;group/&#123;id&#125;/users&quot;)</div><div class="line">Call&lt;List&lt;User&gt;&gt; groupList(@Path(&quot;id&quot;) Integer groupId);</div></pre></td></tr></table></figure>
<p><code>案例2：GET请求，带查询参数；类似于Spring中的@RequestParam注解</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@GET(&quot;group/user&quot;)</div><div class="line">Call&lt;List&lt;User&gt;&gt; getUser(@Query(&quot;name&quot;) String name);</div></pre></td></tr></table></figure>
<p><code>案例3: POST请求，参数是一个对象，类似于Spring中的@RequestBody注解</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@POST(&quot;/users/new&quot;)</div><div class="line">Call&lt;User&gt; createUser(@Body User user);</div></pre></td></tr></table></figure>
<p><code>案例4: 请求内容类型为</code>form-encoded<code>格式</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//每一个key-value键值对用@Field表示 </div><div class="line">@FormUrlEncoded</div><div class="line">@POST(&quot;user/edit&quot;)</div><div class="line">Call&lt;User&gt; updateUser(@Field(&quot;firstName&quot;) String first,@Field(&quot;lastName&quot;) String last);</div></pre></td></tr></table></figure>
<p><code>案例5：声明请求头参数</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// 单个请求头参数</div><div class="line">@Headers(&quot;Cache-Control: max-age=640000&quot;)</div><div class="line">@GET(&quot;widget/list&quot;)</div><div class="line">Call&lt;List&lt;Widget&gt;&gt; widgetList();</div><div class="line"></div><div class="line">// 多个请求头参数</div><div class="line">@Headers(&#123;</div><div class="line">    &quot;Accept: application/vnd.github.v3.full+json&quot;,</div><div class="line">    &quot;User-Agent: Retrofit-Sample-App&quot;</div><div class="line">&#125;)</div><div class="line">@GET(&quot;users&quot;)</div><div class="line">Call&lt;User&gt; getUser();</div><div class="line"></div><div class="line">// 参数中带请求头</div><div class="line">@GET(&quot;user&quot;)</div><div class="line">Call&lt;User&gt; getUser(@Header(&quot;Authorization&quot;) String authorization)</div></pre></td></tr></table></figure>
<p><strong>转化器</strong></p>
<p>默认情况下，<code>Retrofit</code>只能反序列化<code>HTTP</code>的<code>Body</code>到<code>okhttp</code>的<code>ResponseBody</code>，并且<code>@Body</code>注解只能接收<code>RequestBody</code>的类型数据。</p>
<p>转换器可以被添加来支持其它类型。下面是6个流行的序列化库来方便操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Gson: com.squareup.retrofit2:converter-gson</div><div class="line">Jackson: com.squareup.retrofit2:converter-jackson</div><div class="line">Moshi: com.squareup.retrofit2:converter-moshi</div><div class="line">Protobuf: com.squareup.retrofit2:converter-protobuf</div><div class="line">Wire: com.squareup.retrofit2:converter-wire</div><div class="line">Simple XML: com.squareup.retrofit2:converter-simplexml</div></pre></td></tr></table></figure>
<p><code>案例：新增Gson转换器</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Retrofit retrofit = new Retrofit.Builder().baseUrl(LOCAL_HOST)</div><div class="line">                .addConverterFactory(GsonConverterFactory.create())</div><div class="line">                .build();</div></pre></td></tr></table></figure>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ol>
<li><a href="http://square.github.io/retrofit/" target="_blank" rel="external">retrofit官网</a></li>
<li><a href="https://realm.io/cn/news/droidcon-jake-wharton-simple-http-retrofit-2/" target="_blank" rel="external">用Retrofit2简化HTTP请求</a></li>
<li><a href="https://my.oschina.net/purplesense/blog/650123" target="_blank" rel="external">Retrofit介绍</a></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/16/JAVA技能树/" itemprop="url">
                  JAVA技能树
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-16T17:27:26+08:00" content="2016-09-16">
              2016-09-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/16/JAVA技能树/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/16/JAVA技能树/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p> 常常问自己，一个合格的工程师应该掌握哪些技能？技术之海太大，时间有限，精力有限，不能遍历；最好的方式是，选取一个方向做深，之后再增加广度，做一个T字型工程师。那对于JAVA工程师，需要掌握哪些必备技能呢？经过调研总结如下，记录下来，时刻鞭策自己，不断学习。</p>
<h3 id="JVM-基础篇"><a href="#JVM-基础篇" class="headerlink" title="JVM (基础篇)"></a>JVM (基础篇)</h3><p><strong>1.1 Java内存模型、Java内存管理、Java堆和栈、垃圾回收</strong></p>
<blockquote>
<p>参考链接：</p>
<p><a href="http://ifeve.com/jmm-faq/" target="_blank" rel="external">Java内存模型FAQ</a></p>
<p><a href="https://www.jcp.org/en/jsr/detail?id=133" target="_blank" rel="external">官方JCP</a></p>
</blockquote>
<p><strong>1.2 了解JVM各种参数及调优</strong></p>
<p><strong>1.3 学习使用Java工具</strong></p>
<blockquote>
<p>jps, jstack, jmap, jconsole, jinfo, jhat, javap, …</p>
<p><a href="http://kenai.com/projects/btrace" target="_blank" rel="external">http://kenai.com/projects/btrace</a></p>
<p><a href="http://www.crashub.org/" target="_blank" rel="external">http://www.crashub.org/</a></p>
<p><a href="https://github.com/taobao/TProfiler" target="_blank" rel="external">https://github.com/taobao/TProfiler</a></p>
<p><a href="https://github.com/CSUG/HouseMD" target="_blank" rel="external">https://github.com/CSUG/HouseMD</a></p>
<p><a href="http://wiki.cyclopsgroup.org/jmxterm" target="_blank" rel="external">http://wiki.cyclopsgroup.org/jmxterm</a></p>
<p><a href="https://github.com/jlusdy/TBJMap" target="_blank" rel="external">https://github.com/jlusdy/TBJMap</a></p>
</blockquote>
<p><strong>1.4 学习Java诊断工具</strong></p>
<blockquote>
<p><a href="http://www.eclipse.org/mat/" target="_blank" rel="external">http://www.eclipse.org/mat/</a></p>
<p><a href="http://visualvm.java.net/oqlhelp.html" target="_blank" rel="external">http://visualvm.java.net/oqlhelp.html</a></p>
</blockquote>
<p><strong>1.5 自己编写各种outofmemory,stackoverflow程序</strong></p>
<blockquote>
<p>HeapOutOfMemory</p>
<p>Young OutOfMemory</p>
<p>MethodArea OutOfMemory</p>
<p>ConstantPool OutOfMemory</p>
<p>DirectMemory OutOfMemory</p>
<p>Stack OutOfMemory Stack OverFlow</p>
</blockquote>
<p><strong>1.6 使用工具尝试解决一下问题，并写下总结</strong></p>
<blockquote>
<p>当一个Java程序响应很慢时，如何查找问题；</p>
<p>当一个Java程序频繁FullGC时，如何解决问题，如何查看垃圾回收日志</p>
<p>当一个Java应用发生OutOfMerrory时该如何解决，年轻代、年老代、永久代解决办法不同，导致原因也不同</p>
<p>参考资料：</p>
<p><a href="http://docs.oracle.com/javase/specs/jvms/se7/html/" target="_blank" rel="external">http://docs.oracle.com/javase/specs/jvms/se7/html/</a></p>
<p><a href="http://www.cs.umd.edu/~pugh/java/memoryModel/" target="_blank" rel="external">http://www.cs.umd.edu/~pugh/java/memoryModel/</a></p>
<p><a href="http://gee.cs.oswego.edu/dl/jmm/cookbook.html" target="_blank" rel="external">http://gee.cs.oswego.edu/dl/jmm/cookbook.html</a></p>
<p><a href="http://www.guru99.com/java-virtual-machine-jvm.html" target="_blank" rel="external">http://www.guru99.com/java-virtual-machine-jvm.html</a></p>
</blockquote>
<h3 id="JAVA基础知识"><a href="#JAVA基础知识" class="headerlink" title="JAVA基础知识"></a>JAVA基础知识</h3><p><strong>2.1 阅读源代码</strong></p>
<blockquote>
<p><code>java.lang.String</code> <code>java.lang.Integer</code> <code>java.lang.Long</code> <code>java.lang.Enum</code> <code>java.math.BigDecimal</code> <code>java.lang.ThreadLocal</code> <code>java.lang.ClassLoader</code>  <code>java.net.URLClassLoader</code> <code>java.util.ArrayList</code>  <code>java.util.LinkedList</code> <code>java.util.HashMap</code>  <code>java.util.LinkedHashMap</code> <code>java.util.TreeMap</code> <code>java.util.HashSet</code> <code>java.util.LinkedHashSet</code> <code>java.util.TreeSet</code></p>
</blockquote>
<p><strong>2.2 熟悉Java中各种变量类型</strong></p>
<p><strong>2.3 熟悉Java String的使用，熟悉String的各种函数</strong></p>
<p><strong>2.4 熟悉Java中各种关键字</strong></p>
<p><strong>2.5 学会使用List、Map、Stack、Queue、Set</strong></p>
<blockquote>
<p>上述数据结构的遍历、排序、去重；</p>
</blockquote>
<p><strong>2.6 Java IO &amp; Java NIO,并使用</strong></p>
<blockquote>
<p><code>java.io.*</code> <code>java.nio.*</code>nio和reactor设计模式 文件编码 字符集</p>
</blockquote>
<p><strong>2.7 Java反射 &amp; javassist</strong></p>
<blockquote>
<p>反射与工厂模式 <code>java.lang.reflect.*</code></p>
</blockquote>
<p><strong>2.8 Java序列化</strong></p>
<blockquote>
<p><code>java.io.Serializable</code> 什么是序列化，为什么序列化 序列化与单例模式 google序列化protobuf</p>
</blockquote>
<p><strong>2.9 虚引用、弱引用、软引用</strong></p>
<blockquote>
<p><code>java.lang.ref.*</code>实验这里引用的回收;</p>
</blockquote>
<p><strong>2.10 熟悉Java系统属性</strong></p>
<blockquote>
<p><code>java.util.Properties</code></p>
</blockquote>
<p><strong>2.11 熟悉Annotation用法</strong></p>
<blockquote>
<p><code>java.lang.annotation.*</code></p>
</blockquote>
<p><strong>2.12 JMS</strong></p>
<blockquote>
<p><code>javax.jms.*</code></p>
</blockquote>
<p><strong>2.13 JMX</strong></p>
<blockquote>
<p><code>java.lang.management.*</code> <code>javax.management.*</code></p>
</blockquote>
<p><strong>2.14 泛型和继承，泛型和擦除</strong></p>
<p><strong>2.15 自动拆箱装箱与字节码</strong></p>
<p><strong>2.16 实现Callback</strong></p>
<p><strong>2.17 java.lang.Void类使用</strong></p>
<p><strong>2.18 java Agent premain函数</strong></p>
<blockquote>
<p><code>java.lang.instrument</code></p>
</blockquote>
<p><strong>2.19 单元测试</strong></p>
<blockquote>
<p><a href="http://junit.org/" target="_blank" rel="external">Junit</a></p>
<p><a href="https://code.google.com/p/jmockit/" target="_blank" rel="external">Jmockit</a></p>
<p><a href="http://works.dgic.co.jp/djunit/" target="_blank" rel="external">djUnit</a></p>
</blockquote>
<p><strong>2.20 Java实现通过正则表达式提取一段文本中的电子邮件，并将@替换为#输出</strong></p>
<blockquote>
<p><code>java.lang.util.regex.*</code></p>
</blockquote>
<p><strong>2.21 学习使用常用的Java工具库</strong></p>
<blockquote>
<p><code>commons.lang</code> <code>commons.*...</code> <code>guava-libraries</code> <code>netty</code></p>
<p>参考资料</p>
<p><a href="http://openjdk.java.net/" target="_blank" rel="external">http://openjdk.java.net/</a></p>
<p><a href="http://commons.apache.org/" target="_blank" rel="external">http://commons.apache.org/</a></p>
<p><a href="https://code.google.com/p/guava-libraries/" target="_blank" rel="external">https://code.google.com/p/guava-libraries/</a></p>
<p><a href="http://netty.io/" target="_blank" rel="external">http://netty.io/</a></p>
<p><a href="http://stackoverflow.com/questions/2954372/difference-between-spi-and-api" target="_blank" rel="external">http://stackoverflow.com/questions/2954372/difference-between-spi-and-api</a></p>
<p><a href="http://stackoverflow.com/questions/11404230/how-to-implement-the-api-spi-pattern-in-java" target="_blank" rel="external">http://stackoverflow.com/questions/11404230/how-to-implement-the-api-spi-pattern-in-java</a></p>
</blockquote>
<p><strong>2.22 什么API &amp; SPI</strong></p>
<blockquote>
<p><a href="https://en.wikipedia.org/wiki/Application_programming_interface" target="_blank" rel="external">API维基百科</a></p>
<p><a href="https://en.wikipedia.org/wiki/Service_provider_interface" target="_blank" rel="external">SPI维基百科</a></p>
</blockquote>
<h3 id="Java并发编程"><a href="#Java并发编程" class="headerlink" title="Java并发编程"></a>Java并发编程</h3><p><strong>3.1 阅读源代码，并学会使用</strong></p>
<blockquote>
<p><code>java.lang.Thread</code> <code>java.lang.Runnable</code> <code>java.util.concurrent.Callable</code> <code>java.util.concurrent.locks.ReentrantLock</code> <code>java.util.concurrent.locks.ReentrantReadWriteLock</code> <code>java.util.concurrent.atomic.Atomic*</code> <code>java.util.concurrent.Semaphore</code> <code>java.util.concurrent.CountDownLatch</code> <code>java.util.concurrent.CyclicBarrier</code> <code>java.util.concurrent.ConcurrentHashMap</code> <code>java.util.concurrent.Executors</code></p>
</blockquote>
<p><strong>3.2 学习使用线程池，自己设计线程池需要注意什么</strong></p>
<p><strong>3.3 锁</strong></p>
<blockquote>
<p>什么是锁，锁的种类有哪些，每种锁有什么特点，适用场景是什么，在并发编程中所的意义是什么</p>
</blockquote>
<p><strong>3.4 <code>synchronized</code>的作用是什么，<code>synchronized</code>和<code>lock</code></strong></p>
<p><strong>3.5 sleep和wait</strong></p>
<p><strong>3.6 <code>wait</code>和<code>notify</code></strong></p>
<p><strong>3.7 写一个死锁的程序</strong></p>
<p><strong>3.8 什么是守护线程，守护线程和非守护线程的区别以及用法</strong></p>
<p><strong>3.9 <code>volatile</code>关键字的理解</strong></p>
<blockquote>
<p>C ++ volatile关键字和Java volatile关键字 happens-before语义 编译器指令重排和CPU指令重排</p>
<p>参考资料</p>
<p><a href="https://en.wikipedia.org/wiki/Memory_ordering" target="_blank" rel="external">Memory ordering 维基百科</a></p>
<p><a href="https://en.wikipedia.org/wiki/Volatile_(computer_programming" target="_blank" rel="external">volatile维基百科</a>)</p>
<p><a href="http://preshing.com/20130702/the-happens-before-relation/" target="_blank" rel="external">The Happens-Before Relation</a></p>
</blockquote>
<p><strong>3.10 以下代码是不是线程安全？为什么？如果为count加上volatile修饰是否能够做到线程安全？你觉得该怎么做是线程安全？</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public class Sample &#123;</div><div class="line">  private static int count = 0;</div><div class="line">  public static void increment() &#123;</div><div class="line">    count++;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>3.11 解释一下下面两段代码的差别？</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// 代码1</div><div class="line">public class Sample &#123;</div><div class="line">  private static int count = 0;</div><div class="line">  synchronized public static void increment() &#123;</div><div class="line">    count++;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 代码2</div><div class="line">public class Sample &#123;</div><div class="line">  private static AtomicInteger count = new AtomicInteger(0);</div><div class="line">  public static void increment() &#123;</div><div class="line">    count.getAndIncrement();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>参考资料</p>
<p><a href="https://book.douban.com/subject/10484692/" target="_blank" rel="external">Java并发编程实战</a></p>
</blockquote>
<h3 id="Java底层知识-进阶篇"><a href="#Java底层知识-进阶篇" class="headerlink" title="Java底层知识(进阶篇)"></a>Java底层知识(进阶篇)</h3><p><strong>4.1 了解字节码、<code>class</code>文件格式</strong></p>
<blockquote>
<p><a href="http://en.wikipedia.org/wiki/Java_class_file" target="_blank" rel="external">http://en.wikipedia.org/wiki/Java_class_file</a><br><a href="http://en.wikipedia.org/wiki/Java_bytecode" target="_blank" rel="external">http://en.wikipedia.org/wiki/Java_bytecode</a><br><a href="http://en.wikipedia.org/wiki/Java_bytecode_instruction_listings" target="_blank" rel="external">http://en.wikipedia.org/wiki/Java_bytecode_instruction_listings</a><br><a href="http://www.csg.ci.i.u-tokyo.ac.jp/~chiba/javassist/" target="_blank" rel="external">http://www.csg.ci.i.u-tokyo.ac.jp/~chiba/javassist/</a><br><a href="http://asm.ow2.org/" target="_blank" rel="external">http://asm.ow2.org/</a></p>
</blockquote>
<p><strong>4.2 写一个程序要求实现javap的功能(手工完成，不借助ASM等工具)</strong></p>
<p><code>Java源码</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public static void main(String[] args) &#123;</div><div class="line">   int i = 0;</div><div class="line">   i += 1;</div><div class="line">   i *= 1;</div><div class="line">   System.out.println(i);</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p><code>编译后读取class文件输出以下代码</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public static void main(java.lang.String[]);</div><div class="line">  Code:</div><div class="line">   Stack=2, Locals=2, Args_size=1</div><div class="line">   0:   iconst_0</div><div class="line">   1:   istore_1</div><div class="line">   2:   iinc    1, 1</div><div class="line">   5:   iload_1</div><div class="line">   6:   iconst_1</div><div class="line">   7:   imul</div><div class="line">   8:   istore_1</div><div class="line">   9:   getstatic       #2; //Field java/lang/System.out:Ljava/io/PrintStream;</div><div class="line">   12:  iload_1</div><div class="line">   13:  invokevirtual   #3; //Method java/io/PrintStream.println:(I)V</div><div class="line">   16:  return</div><div class="line">  LineNumberTable: </div><div class="line">   line 4: 0</div><div class="line">   line 5: 2</div><div class="line">   line 6: 5</div><div class="line">   line 7: 9</div><div class="line">   line 8: 16</div></pre></td></tr></table></figure>
<p><strong>4.3 CPU缓存，L1,L2,L3和伪共享</strong></p>
<blockquote>
<p><a href="http://duartes.org/gustavo/blog/post/intel-cpu-caches/" target="_blank" rel="external">http://duartes.org/gustavo/blog/post/intel-cpu-caches/</a><br><a href="http://mechanical-sympathy.blogspot.com/2011/07/false-sharing.html" target="_blank" rel="external">http://mechanical-sympathy.blogspot.com/2011/07/false-sharing.html</a></p>
</blockquote>
<p><strong>4.4 什么是尾递归</strong></p>
<p><strong>4.5 熟悉位运算</strong></p>
<blockquote>
<p>用位运算实现加、减、乘、除、取余</p>
<p>参考资料：</p>
<ol>
<li><a href="https://book.douban.com/subject/1138768/" target="_blank" rel="external">深入Java虚拟机</a></li>
<li><a href="https://book.douban.com/subject/6522893/" target="_blank" rel="external">深入理解Java虚拟机</a></li>
<li><a href="https://en.wikipedia.org/wiki/Java_class_file" target="_blank" rel="external">Java class file维基百科</a></li>
<li><a href="https://en.wikipedia.org/wiki/Java_bytecode" target="_blank" rel="external">Java bytecode维基百科</a></li>
<li><a href="https://en.wikipedia.org/wiki/Java_bytecode_instruction_listings" target="_blank" rel="external">Java bytecode instruction listings维基百科</a></li>
</ol>
</blockquote>
<h3 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h3><p><strong>5.1 实现AOP</strong></p>
<blockquote>
<p><a href="http://cglib.sourceforge.net/" target="_blank" rel="external">CGLIB和InvocationHandler的区别</a></p>
<p><a href="http://www.csg.ci.i.u-tokyo.ac.jp/~chiba/javassist/" target="_blank" rel="external">动态代理模式Javassist实现AOP</a></p>
<p><a href="http://asm.ow2.org/" target="_blank" rel="external">ASM实现AOP</a></p>
<p><strong>5.2 使用模板方法设计模式和策略设计模式实现IOC</strong></p>
</blockquote>
<p><strong>5.3 不使用<code>synchronized</code>和<code>Lock</code>，实现线程安全的单例模式</strong></p>
<p><strong>5.4 nio和reactor设计模式</strong></p>
<h3 id="网络编程知识"><a href="#网络编程知识" class="headerlink" title="网络编程知识"></a>网络编程知识</h3><p><strong>6.1 <code>Java RMI</code>、<code>Socket</code>、<code>HttpClient</code></strong></p>
<p><strong>6.2 用<code>Java</code>写一个简单的静态文件的<code>HTTP</code>服务器</strong></p>
<blockquote>
<p>实现客户端缓存功能，支持返回304实现可并发下载一个文件，使用线程池处理客户端请求，使用nio处理客户端请求，支持简单的rewrite规则。上述功能在实现的时候需要满足<a href="https://en.wikipedia.org/wiki/Open/closed_principle" target="_blank" rel="external">“开闭原则”</a></p>
</blockquote>
<p><strong>6.3 了解Nignx和Apache服务器的特性并搭建一个对应的服务器</strong></p>
<blockquote>
<p><a href="http://nginx.org/" target="_blank" rel="external">Nginx官方链接</a></p>
<p><a href="http://httpd.apache.org/" target="_blank" rel="external">Apache官方链接</a></p>
</blockquote>
<p><strong>6.4 用Java实现FTP、SMTP协议</strong></p>
<p><strong>6.5 什么是CND? 如何实现？DNS起到什么作用？</strong></p>
<blockquote>
<p>搭建一个DNS服务器 搭建一个 Squid 或 Apache Traffic Server 服务器 <a href="http://www.squid-cache.org/" target="_blank" rel="external">http://www.squid-cache.org/</a> <a href="http://trafficserver.apache.org/" target="_blank" rel="external">http://trafficserver.apache.org/</a> <a href="http://en.wikipedia.org/wiki/Domain_Name_System" target="_blank" rel="external">http://en.wikipedia.org/wiki/Domain_Name_System</a></p>
</blockquote>
<h3 id="框架知识"><a href="#框架知识" class="headerlink" title="框架知识"></a>框架知识</h3><p><strong>7 Spring框架 &amp; Mybatis</strong></p>
<blockquote>
<p>阅读 Sping、Spring MVC、Mybatis主要源码；用Spring和Mybatis搭建Java Server</p>
</blockquote>
<h3 id="应用服务器"><a href="#应用服务器" class="headerlink" title="应用服务器"></a>应用服务器</h3><p><strong>8 常用应用服务器</strong></p>
<blockquote>
<p>熟悉使用<a href="http://www.jboss.org/" target="_blank" rel="external">JBoss</a></p>
<p>熟悉使用<a href="http://tomcat.apache.org/" target="_blank" rel="external">Tomcat</a></p>
<p>熟悉使用<a href="http://www.eclipse.org/jetty/" target="_blank" rel="external">Jetty</a></p>
</blockquote>
<h3 id="编译原理知识"><a href="#编译原理知识" class="headerlink" title="编译原理知识"></a>编译原理知识</h3><p><strong>9.1 用Java实现以下表达式解析并返回结果</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sysdate</div><div class="line">sysdate - 1</div><div class="line">sysdate - 1/24</div><div class="line">sysdate - 1/(12*2)</div></pre></td></tr></table></figure>
<p><strong>9.2 实现对一个List通过DSL筛选</strong></p>
<p>要求返回列表中匹配的对象，即最后两个对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">QList&lt;Map&lt;String, Object&gt;&gt; mapList = new QList&lt;Map&lt;String, Object&gt;&gt;;</div><div class="line">  mapList.add(&#123;&quot;name&quot;: &quot;hatter test&quot;&#125;);</div><div class="line">  mapList.add(&#123;&quot;id&quot;: -1,&quot;name&quot;: &quot;hatter test&quot;&#125;);</div><div class="line">  mapList.add(&#123;&quot;id&quot;: 0, &quot;name&quot;: &quot;hatter test&quot;&#125;);</div><div class="line">  mapList.add(&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;test test&quot;&#125;);</div><div class="line">  mapList.add(&#123;&quot;id&quot;: 2, &quot;name&quot;: &quot;hatter test&quot;&#125;);</div><div class="line">  mapList.add(&#123;&quot;id&quot;: 3, &quot;name&quot;: &quot;test hatter&quot;&#125;);</div><div class="line">  mapList.query(&quot;id is not null and id &gt; 0 and name   like &apos;%hatter%&apos;&quot;);</div></pre></td></tr></table></figure>
<p><strong>9.3 用Java实现以下程序（语法和变量作用域处理都和JavaScript类似</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">var a = 1;</div><div class="line">var b = 2;</div><div class="line">var c = function() &#123;</div><div class="line">  var a = 3;</div><div class="line">  println(a);</div><div class="line">  println(b);</div><div class="line">&#125;;</div><div class="line">c();</div><div class="line">println(a);</div><div class="line">println(b);</div></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">3</div><div class="line">2</div><div class="line">1</div><div class="line">2</div></pre></td></tr></table></figure>
<h3 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h3><p><strong>10 常用操作系统</strong></p>
<blockquote>
<p><code>Ubuntu Centos</code> 使用<code>Linix</code>，熟悉<code>Shell</code>脚本</p>
</blockquote>
<h3 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h3><p><strong>11.1 关系型数据库</strong></p>
<blockquote>
<p><code>MySQL</code> 如何看执行计划 如何搭建<code>MySQL</code>主备 <code>binlog</code>是什么 <code>Derby</code>，<code>H2</code>，<code>PostgreSQL</code> <code>SQLite</code></p>
</blockquote>
<p><strong>11.2 NoSQL</strong></p>
<blockquote>
<p><a href="http://redis.io/" target="_blank" rel="external">Redis</a></p>
<p><a href="https://memcached.org/" target="_blank" rel="external">Memecached</a></p>
<p><a href="http://cassandra.apache.org/" target="_blank" rel="external">cassandra</a></p>
<p><a href="https://code.google.com/p/leveldb/" target="_blank" rel="external">Leveldb</a></p>
<p><a href="http://hbase.apache.org/" target="_blank" rel="external">HBase</a></p>
<p><a href="http://www.mongodb.org/" target="_blank" rel="external">MongoDB</a></p>
<p><a href="http://www.neo4j.org/" target="_blank" rel="external">图数据库neo4j</a></p>
</blockquote>
<h3 id="大数据"><a href="#大数据" class="headerlink" title="大数据"></a>大数据</h3><p><strong>12.1 <code>Zookeeper</code>,在<code>Linix</code>上部署ZK</strong></p>
<p><strong>12.2 <code>Solr</code>、<code>Lucence</code>、<code>ElasticSearch</code></strong></p>
<blockquote>
<p>在<code>Linux</code>上部署<code>Solr</code>、<code>solrCloud</code>、新增、删除、查询索引</p>
</blockquote>
<p><strong>12.3 <code>Storm</code> 流式计算，了解<code>Spark</code> <code>S4</code></strong></p>
<blockquote>
<p>在<code>Linux</code>上部署<code>Storm</code>，用<code>Zookeeper</code>做协调，运行Storm Hello World;Local和Remote 模式运行调试<code>storm topology</code></p>
</blockquote>
<p><strong>12.4 Hadoop,离线计算</strong></p>
<blockquote>
<p><code>HDFS</code>: 部署<code>NameNode</code> <code>SecondaryNameNode</code> <code>DataNode</code>、上传文件、打开文件、更改文件、删除文件</p>
<p><code>MapReduce</code>：部署<code>JobTracker</code>，<code>TaskTracker</code>，编写mr job</p>
<p><code>Hive</code>：部署<code>hive</code>，书写hive sql，得到结果</p>
<p><code>Presto</code>：类<code>hive</code>，不过比<code>hive</code>快，非常值得学习署</p>
</blockquote>
<p><strong>12.5 分布式日志收集<code>Flume</code>、<code>Kafka</code>、<code>Logstash</code></strong></p>
<p><strong>12.6 数据挖掘，<code>Mahout</code></strong></p>
<h3 id="网络安全知识"><a href="#网络安全知识" class="headerlink" title="网络安全知识"></a>网络安全知识</h3><p><strong>13.1 什么是<code>DES</code>、<code>AES</code></strong></p>
<p><strong>13.2 什么是<code>RSA</code>、<code>DSA</code></strong></p>
<p><strong>13.3 什么是<code>MD5</code>，<code>SHA1</code></strong></p>
<p><strong>13.4 什么是<code>SSL</code>、<code>TLS</code>，为什么<code>HTTPS</code>相对比较安全</strong></p>
<p><strong>13.5 什么是中间人攻击、如果避免中间人攻击</strong></p>
<p><strong>13.6 什么是<code>DOS</code>、<code>DDOS</code>、<code>CC</code>攻击</strong></p>
<p><strong>13.7 什么是<code>CSRF</code>攻击</strong></p>
<p><strong>13.8 什么是<code>CSS</code>攻击</strong></p>
<p><strong>13.9 什么是<code>SQL</code>注入攻击</strong></p>
<p><strong>13.10 什么是<code>Hash</code>碰撞拒绝服务攻击</strong></p>
<p><strong>13.11 了解并学习下面几种增强安全的技术</strong></p>
<blockquote>
<p>参考资料<br><a href="http://www.openauthentication.org/" target="_blank" rel="external">http://www.openauthentication.org/</a><br>HOTP <a href="http://www.ietf.org/rfc/rfc4226.txt" target="_blank" rel="external">http://www.ietf.org/rfc/rfc4226.txt</a><br>TOTP <a href="http://tools.ietf.org/rfc/rfc6238.txt" target="_blank" rel="external">http://tools.ietf.org/rfc/rfc6238.txt</a><br>OCRA <a href="http://tools.ietf.org/rfc/rfc6287.txt" target="_blank" rel="external">http://tools.ietf.org/rfc/rfc6287.txt</a><br><a href="http://en.wikipedia.org/wiki/Salt_(cryptography" target="_blank" rel="external">http://en.wikipedia.org/wiki/Salt_(cryptography</a>)</p>
</blockquote>
<p><strong>13.12 用<code>openssl</code>签一个证书部署到<code>apache</code>或<code>nginx</code></strong></p>
<blockquote>
<p>参考资料<br><a href="http://en.wikipedia.org/wiki/Cryptographic_hash_function" target="_blank" rel="external">http://en.wikipedia.org/wiki/Cryptographic_hash_function</a><br><a href="http://en.wikipedia.org/wiki/Block_cipher" target="_blank" rel="external">http://en.wikipedia.org/wiki/Block_cipher</a><br><a href="http://en.wikipedia.org/wiki/Public-key_cryptography" target="_blank" rel="external">http://en.wikipedia.org/wiki/Public-key_cryptography</a><br><a href="http://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank" rel="external">http://en.wikipedia.org/wiki/Transport_Layer_Security</a><br><a href="http://www.openssl.org/" target="_blank" rel="external">http://www.openssl.org/</a><br><a href="https://code.google.com/p/google-authenticator/" target="_blank" rel="external">https://code.google.com/p/google-authenticator/</a></p>
</blockquote>
<h3 id="扩展技能"><a href="#扩展技能" class="headerlink" title="扩展技能"></a>扩展技能</h3><p><strong>14.1 云计算、分布式、高可用、可扩展</strong></p>
<p><strong>14.2 虚拟化</strong></p>
<blockquote>
<p><a href="https://linuxcontainers.org/" target="_blank" rel="external">https://linuxcontainers.org/</a></p>
<p><a href="http://www.linux-kvm.org/page/Main_Page" target="_blank" rel="external">http://www.linux-kvm.org/page/Main_Page</a></p>
<p><a href="http://www.xenproject.org/" target="_blank" rel="external">http://www.xenproject.org/</a></p>
<p><a href="https://www.docker.io/" target="_blank" rel="external">https://www.docker.io/</a></p>
</blockquote>
<p><strong>14.3 监控</strong></p>
<blockquote>
<p><a href="http://www.nagios.org/" target="_blank" rel="external">http://www.nagios.org/</a></p>
<p><a href="http://ganglia.info/" target="_blank" rel="external">http://ganglia.info/</a></p>
</blockquote>
<p><strong>14.4 负载均衡</strong></p>
<blockquote>
<p><a href="http://www.linuxvirtualserver.org/" target="_blank" rel="external">http://www.linuxvirtualserver.org/</a></p>
</blockquote>
<p><strong>14.5 学会使用Git</strong></p>
<blockquote>
<p><a href="https://github.com/" target="_blank" rel="external">https://github.com/</a></p>
<p><a href="https://git.oschina.net/" target="_blank" rel="external">https://git.oschina.net/</a></p>
</blockquote>
<p><strong>14.6 学会使用<code>Maven</code></strong></p>
<blockquote>
<p><a href="http://maven.apache.org/" target="_blank" rel="external">http://maven.apache.org/</a></p>
</blockquote>
<p><strong>14.7 学习一个小语种语言</strong></p>
<blockquote>
<p><code>Groovy</code> <code>Scala</code> <code>LISP</code>  <code>Common LISP</code> <code>Schema</code>, <code>Clojure</code> <code>R</code> <code>Julia</code> <code>Lua</code> <code>Ruby</code></p>
</blockquote>
<p><strong>14.8 尝试了解编码的本质</strong></p>
<blockquote>
<p>了解以下概念<code>ASCLL</code>，<code>ISO-8859-1</code> <code>GB2312</code> <code>GBK</code> <code>GB18030 Unicode</code>,<code>UTF-8</code>不使用<code>String.getBytes()</code>等其他工具类/函数完成下面功能</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public static void main(String[] args) throws IOException &#123;</div><div class="line">    String str = &quot;Hello, 我们是中国人。&quot;;</div><div class="line">    byte[] utf8Bytes = toUTF8Bytes(str);</div><div class="line">    FileOutputStream fos = new FileOutputStream(&quot;f.txt&quot;);</div><div class="line">    fos.write(utf8Bytes);</div><div class="line">    fos.close();</div><div class="line">&#125;</div><div class="line">public static byte[] toUTF8Bytes(String str) &#123;</div><div class="line">    return null; // TODO</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>想以下上面的程序能不能写一个转GBK的？写个程序自动判断一个文件时哪一种编码？</p>
</blockquote>
<p><strong>14.9 尝试了解时间的本质</strong></p>
<blockquote>
<p><a href="https://en.wikipedia.org/wiki/Time_zone" target="_blank" rel="external">时区</a> &amp; 冬令时 &amp; 夏令时</p>
<p><a href="https://en.wikipedia.org/wiki/Leap_year" target="_blank" rel="external">闰年</a></p>
<p><a href="ftp://ftp.iana.org/tz/data/leapseconds" target="_blank" rel="external">闰秒</a></p>
</blockquote>
<h3 id="横向扩展技能"><a href="#横向扩展技能" class="headerlink" title="横向扩展技能"></a>横向扩展技能</h3><p><strong>15.1 <code>JavaScript</code>知识</strong></p>
<p><strong>15.2 什么是<code>prototype</code></strong></p>
<blockquote>
<p>修改代码，是程序输出 <code>1 3 5</code>  <code>http://jsfiddle.net/Ts7Fk/</code></p>
</blockquote>
<p><strong>15.3 什么是闭包</strong></p>
<blockquote>
<p>看一下这段代码，并解释一下为什么按<code>Button1</code>时没有<code>alert</code>出<code>This is button: 1</code>，如何修改:<code>http://jsfiddle.net/FDPj3/1/</code></p>
</blockquote>
<p><strong>15.4 学习一个JS框架</strong></p>
<blockquote>
<p><code>React</code> <code>ArgularJS</code> <code>ExtJS</code> <code>JQuery</code></p>
</blockquote>
<p><strong>15.5 写一个<a href="http://en.wikipedia.org/wiki/Greasemonkey" target="_blank" rel="external">Greasemonkey</a>插件</strong></p>
<p><strong>15.6 学习<a href="http://nodejs.org/" target="_blank" rel="external">node.js</a></strong></p>
<p><strong>15.7 学习<code>Html5</code></strong></p>
<blockquote>
<p><a href="https://docs.angularjs.org/api" target="_blank" rel="external">ArgularJS</a></p>
</blockquote>
<p>未完待续….</p>
<h3 id="推荐书籍"><a href="#推荐书籍" class="headerlink" title="推荐书籍"></a>推荐书籍</h3><blockquote>
<p><a href="http://www.hollischuang.com/archives/489?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io" target="_blank" rel="external">七周七语言</a></p>
<p><a href="https://detail.tmall.com/item.htm?id=522029636170" target="_blank" rel="external">七周七数据库</a></p>
<p><a href="https://detail.tmall.com/item.htm?id=525319334615" target="_blank" rel="external">Hadoop技术内幕</a></p>
<p><a href="https://detail.tmall.com/item.htm?id=25826348062&amp;ali_trackid=2:mm_42606752_12122458_44532463:1474073093_2k4_386928692&amp;pvid=200_10.176.139.147_1100_1474073093283" target="_blank" rel="external">Hbase In Action</a></p>
<p><a href="https://detail.tmall.com/item.htm?id=521649099033&amp;ali_trackid=2:mm_42606752_12122458_44532463:1474073128_3k1_97638280&amp;pvid=200_10.176.139.154_1162_1474073128458" target="_blank" rel="external">这就是搜索引擎</a></p>
<p><a href="https://detail.tmall.com/item.htm?id=521912282578&amp;ali_trackid=2:mm_42606752_12122458_44532463:1474073152_3k2_1235641721&amp;pvid=200_10.176.139.184_1216_1474073152748" target="_blank" rel="external">深入分析Java Web技术内幕</a></p>
<p><a href="https://detail.tmall.com/item.htm?id=520125493740&amp;ali_trackid=2:mm_42606752_12122458_44532463:1474073190_2k7_326211549&amp;pvid=200_10.176.139.160_1042_1474073190008" target="_blank" rel="external">大型网站技术架构</a></p>
<p><a href="https://detail.tmall.com/item.htm?id=522994008657&amp;ali_trackid=2:mm_42606752_12122458_44532463:1474073238_214_523050217&amp;pvid=200_10.176.139.147_473_1474073238628" target="_blank" rel="external">算法导论</a></p>
<p><a href="https://detail.tmall.com/item.htm?id=525443498378" target="_blank" rel="external">代码大全</a></p>
<p>JavaScript权威指南</p>
<p>高性能MySQL</p>
<p>计算机程序设计艺术</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/14/Spring数据校验/" itemprop="url">
                  Spring数据校验
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-14T19:01:28+08:00" content="2016-09-14">
              2016-09-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/14/Spring数据校验/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/14/Spring数据校验/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>有一句话怎么说来着？对于外部输入的数据都是不可信的，都需要进行校验。故对于入参的校验是后端必不可少的工作,<code>JAVA</code>中提供了一套注解可供校验入参时不为NULL，不为空。</p>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><p>场景：入参是一个对象，需要保证对象中的某些参数不为空，或不为NULL。</p>
<p>注意事项：</p>
<ol>
<li>对象前加<code>@Valid</code>注解，表示对象中的参数严格按照注解规范</li>
<li>属性前加<code>@NotNull</code>注解，表示对象中的属性不能为NULL，但允许为空，即(“”、”空格1”、”空格1空格2”)这三种情况均可。</li>
<li>属性前加<code>@NotEmpty</code>注解，表示对象中的属性不能为NULL，且长度必须大于0，，即(“空格1”、”空格1空格2”)这两种情况均可，(“”)这种情况长度为0，不是满足条件的。</li>
<li>属性前加<code>@NotBlank</code>注解，该注解只能作用于<code>String</code>上，不能为NULL，而且调用trim()后，长度必须大于0；</li>
</ol>
<h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p><strong>对象模型User.class</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">public class User &#123;</div><div class="line">    @NotNull</div><div class="line">    private String name;</div><div class="line"></div><div class="line">    @NotEmpty</div><div class="line">    private String password;</div><div class="line"></div><div class="line">    @NotBlank</div><div class="line">    private String nickName;</div><div class="line"></div><div class="line">    @Valid</div><div class="line">    private Address address;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        User user = new User();</div><div class="line">        Address address = new Address();</div><div class="line">        address.setPlaceNo(234);</div><div class="line">        address.setPlace(&quot;shanghai&quot;);</div><div class="line">        user.setPassword(&quot;12321&quot;);</div><div class="line">        user.setName(&quot;zhangsan&quot;);</div><div class="line">        user.setName(&quot;zhaowu&quot;);</div><div class="line">        user.setAddress(address);</div><div class="line">        System.out.println(JSON.toJSONString(user));</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 此处省略 Getter &amp; Setter方法</div></pre></td></tr></table></figure>
<p><strong>对象模型Address.class</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public class Address &#123;</div><div class="line">    @NotNull</div><div class="line">    private String place;</div><div class="line">    @NotNull</div><div class="line">    private Integer placeNo;</div><div class="line">    </div><div class="line">    // 此处省略 Getter &amp; Setter方法</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>SpringBoot的Controller层: AdminController.class</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@RestController</div><div class="line">public class AdminController &#123;</div><div class="line">    @RequestMapping(value = &quot;/userInfo&quot;,method = RequestMethod.POST)</div><div class="line">    public String get(@RequestBody @Valid User user)&#123;</div><div class="line">        return JSON.toJSONString(user);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>需要特别注意的是，一个对象中包含另外一个子对象，需要对子对象中的参数进行校验，子对象前需要加上<code>@Valid</code>注解。</p>
<p><strong>提示：</strong> 为了让例子更加简单，将<code>AdminController</code>原来返回的<code>JsonResult</code>对象改为了<code>String</code>，故验证部分的返回值和按照上述教程所得到的返回值是不一致的。</p>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p><strong>尝试1：验证加上@NotNull注解，该属性不能为NULL</strong></p>
<p><img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-16/7654533.jpg" alt=""></p>
<p><strong>尝试2：验证加上@NotEmpty注解，该入参长度需大于0</strong></p>
<p><img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-16/98161087.jpg" alt=""></p>
<p><strong>尝试3：验证加上@NotEmpty注解，该入参长度需大于0，包含空格</strong><br><img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-16/6368009.jpg" alt=""></p>
<p><strong>尝试4：验证加上@NotBlank注解，该入参长度在去除空格之后，长度大于0</strong></p>
<p><img src="http://oc5a5l0a0.bkt.clouddn.com/16-9-16/51683357.jpg" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://oc5a5l0a0.bkt.clouddn.com/16-10-7/31807945.jpg"
               alt="流云" />
          <p class="site-author-name" itemprop="name">流云</p>
          <p class="site-description motion-element" itemprop="description">每天进步一点</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">145</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">31</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">流云</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io" rel="external nofollow">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
<a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"jianwl"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
